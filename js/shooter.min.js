var version='1.1.5';var App=function(){'use strict';var W=false||checkForMobileDevice();var bb=false||getBrowserVersion('Trident/([0-9]{1,}[.0-9]{0,})');var n;var y=false;var u=false;var I=null;var v=false;var E=1;var bc=0;var O=4;var P=4;var J=200;var X=[400,600,800,1500,5000];var K=2000;var F;var Y=[200,200,200,300,400,400,600,500,400,600];var A=1000;var w;var B=[];var Z;var h=0;var Q=1000;var G={data:'overkill'};var R;var q=100;var ba;var s=1;var C=null;var j=false;var m=wade.retrieveLocalObject(G.data);const sissy=(m&&m.sissy)||false;var D=(m&&m.highscore)||0;var e={logo:'../img/logo.png',ship:'../img/ship.png',boom:{0:{file:'../img/animations/explosion/explode_4x4_ship.png',speed:30,x:4,y:4},1:{file:'../img/animations/explosion/explode_4x4_ring.png',speed:30,x:4,y:4},2:{file:'../img/animations/explosion/explode_5x3_enemy.png',speed:30,x:5,y:3}},flyLeft:'../img/animations/ship/fly_left.png',flyRight:'../img/animations/ship/fly_right.png',shipBullet:'../img/bullets/bullet_ship.png',enemyBullets:{0:{file:'../img/bullets/bullet0.png',delay:600,damage:1},1:{file:'../img/bullets/bullet1.png',delay:500,damage:3},2:{file:'../img/bullets/bullet2.png',delay:400,damage:5},3:{file:'../img/bullets/bullet3.png',delay:300,damage:10},4:{file:'../img/bullets/bullet4.png',delay:200,damage:20}},enemies:{0:'../img/enemies/enemy0.png',1:'../img/enemies/enemy1.png',2:'../img/enemies/enemy2.png',3:'../img/enemies/enemy3.png',4:'../img/enemies/enemy4.png'},asteroids:{0:'../img/asteroids/asteroid0.png',1:'../img/asteroids/asteroid1.png',2:'../img/asteroids/asteroid2.png',3:'../img/asteroids/asteroid3.png',4:'../img/asteroids/asteroid4.png',5:'../img/asteroids/asteroid5.png',6:'../img/asteroids/asteroid6.png',7:'../img/asteroids/asteroid7.png',8:'../img/asteroids/asteroid8.png',9:'../img/asteroids/asteroid9.png'},healthIcon:'../img/icons/heart.png',levelIcon:'../img/icons/star.png',scoreIcon:'../img/icons/trophy.png'};var r={shoot:'../sounds/shoot.mp3',hit:'../sounds/hit.mp3',explode:'../sounds/explode.mp3',loop:'../sounds/loop.mp3',menu:'../sounds/menu.mp3'};var bd=document.getElementById('toggleRendererTitle');var S=$('#toggleRendererBtn');var T=document.getElementById('toggleMusicTitle');var z=$('#toggleMusicBtn');var U=document.getElementById('game');var be=document.getElementById('game-icons');$('#version').text(version+', WADE '+wade.getVersion());$(window).blur(function(){if(u&&!y){console.log('Game paused due to focus loss.')}wade.app.pauseGame()});$(window).focus(function(){if(!u){console.log('Game resumed due to focus gain.');w=setTimeout(wade.app.spawnAsteroid,A);if(j){wade.app.musicOn()}wade.resumeSimulation()}});wade.preventIframe();wade.setLoadingBar(true,{x:0,y:0},'#333333','#222222');wade.setLoadingImages('../img/loading.svg');this.padStrings=function(a){var b='       ';var d;if(typeof(a)==='object'){d={};for(var c in a){if({}.hasOwnProperty.call(a,c)){d[c]=b+a[c]+b}}}else{d=b+a+b}return d};this.load=function(){var a=0;for(a=0;a<Object.keys(e.asteroids).length;a++){wade.loadImage(e.asteroids[a])}wade.loadImage(e.logo);for(a=0;a<Object.keys(e.boom).length;a++){wade.loadImage(e.boom[a].file)}wade.loadImage(e.shipBullet);for(a=0;a<Object.keys(e.enemyBullets).length;a++){wade.loadImage(e.enemyBullets[a].file)}for(a=0;a<Object.keys(e.enemies).length;a++){wade.loadImage(e.enemies[a])}wade.loadImage(e.ship);wade.loadImage(e.flyLeft);wade.loadImage(e.flyRight);wade.loadImage(e.healthIcon);wade.loadImage(e.levelIcon);wade.loadImage(e.scoreIcon);var b=wade.isWebAudioSupported()?'loadAudio':'preloadAudio';wade[b](r.shoot);wade[b](r.hit);wade[b](r.explode);wade[b](r.loop);wade[b](r.menu);var d=null;d=setInterval(function(){console.log('Loaded '+Math.round(wade.getLoadingPercentage())+'% of data.');if(wade.getLoadingPercentage()>=100){clearInterval(d)}},1000)};this.init=function(){m=wade.retrieveLocalObject(G.data);v=(m&&m.force2d)||v;wade.setLayerRenderMode(E,'2d');wade.useQuadtree(E,false);S.removeClass('fa-toggle-on');S.addClass('fa-toggle-off');bd.title='Enable WebGL';if(!v){wade.setLayerRenderMode(E,'webgl');S.removeClass('fa-toggle-off');S.addClass('fa-toggle-on');bd.title='Disable WebGL'}if(wade.isWebAudioSupported()){j=(m&&m.music)||j;if(wade.getWebAudioContext().state=='suspended'){j=false}if(j){z.removeClass('music-off');z.addClass('music-on');T.title='Disable music'}}else{j=false}wade.setMinScreenSize($(window).width(),$(window).height());wade.setMaxScreenSize($(window).width(),$(window).height());wade.setResolutionFactor(1);if(W){wade.setMinScreenSize($(window).width()*3,$(window).height()*3);wade.setMaxScreenSize($(window).width()*3,$(window).height()*3);wade.setResolutionFactor(0.5)}var a=wade.getLayerRenderMode(E);var b={insertCoin:'- INSERT COIN -',highscoreIs:'HIGHSCORE IS %i POINTS',youScored:'YOU %s %i POINTS'};if(a==='webgl'){b=wade.app.padStrings(b)}var d=new TextSprite(b.insertCoin,'36pt Highspeed','white','center');d.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,d.draw));var c=new SceneObject();c.addSprite(d,{y:320});wade.app.getHighestScore(h,c,b);if(h>0){var g=Base64.decode('U0NPUkVE');if(sissy){g=Base64.decode('Q0hFQVRFRA==')}else{$('#highscoreWrapper').fadeToggle();wade.app.loadHighscore(h)}var f=b.youScored.replace('%s',g);f=f.replace('%i',h);if(a==='webgl'){f=wade.app.padStrings(f)}c.addSprite(new TextSprite(f,'24pt Highspeed','white','center'),{y:120});if(h>D){var k=Base64.decode('TkVXIEhJR0hTQ09SRQ==');D=h;h=0;if(sissy){k+=Base64.decode('IE5PVCBTQVZFRA==')}k+='!';if(a==='webgl'){k=wade.app.padStrings(k)}var i=new TextSprite(k,'24pt Highspeed','yellow','center');c.addSprite(i,{y:160})}}c.addSprite(new Sprite(e.logo),{y:-200});I=new SceneObject();var l=new TextSprite('PAUSED','32pt Highspeed','yellow','center');l.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,l.draw));I.addSprite(new Sprite(e.logo),{y:-200});I.addSprite(l,{y:160});be.style.display='block';U.style.cursor='default';wade.addSceneObject(c);var t=null;t=setTimeout(function(){if(wade.getLoadingPercentage()>=100){console.log('Initializing asteroids on main screen.');w=setTimeout(wade.app.spawnAsteroid,A);clearInterval(t)}},1000);if(j){wade.app.musicOn()}wade.app.onMouseDown=function(){if(wade.isMouseDown(0)||(wade.isMouseDown()&&(W||bb))){be.style.display='none';U.style.cursor='none';clearTimeout(w);wade.removeSceneObject(c);wade.clearScene();wade.removeUnusedLayers([1]);wade.clearCanvas(E);wade.app.onMouseDown=0;wade.app.startGame()}}};this.getHighestScore=function(c,g,f){var k=setInterval(function(){var a={'action':'getHighestScore'};var b=JSON.stringify(a);var d=Base64.encode(b);$.ajax({url:'php/backend.php',type:'POST',data:'data='+d,success(result){if(result==null||result==''||result=='FAILED'){result=D}if(c<=0||result>c){f.highscoreIs=f.highscoreIs.replace('%i',result);g.addSprite(new TextSprite(f.highscoreIs,'24pt Highspeed','yellow','center'),{y:160})}D=result;clearTimeout(k)},error(xhr,status,code){console.warn('getHighestScore(): AJAX call returned: '+status+': '+code)}})},1000)};this.loadHighscore=function(d){var c={'action':'loadScore'};var g=JSON.stringify(c);var f=Base64.encode(g);var k='Highscore not loaded!';d=(typeof(d)!=='undefined')?d:h;$.ajax({url:'php/backend.php',type:'POST',data:'data='+f,success(result){if(result!='FAILED'){console.log('Score: '+d);var i='';var l='<tr><td id="playerNameCell"><input type="text" class="highscore" id="playerName" maxlength="20" value="" placeholder="Enter your name"/></td><td>'+d+'</td></tr>';var t=JSON.parse(result);var L=Object.keys(t).length;var o=false;$.each(t,function(a,b){if(d>0&&d>=b.score&&!o){i+=l;o=true}if(a<9||!o){i+='<tr><td>'+b.player+'</td><td>'+b.score+'</td></tr>'}});if(L<10&&!o&&d>0){i+=l;o=true}$('#highscoreTable').html(i);if(o){$('#playerName').focus();$('#playerName').on('keypress',function(a){if(a.keyCode==13){a.preventDefault();var b=$('#playerName').val();if(b.length>0){$(this).prop('disabled',true);wade.app.saveHighscore(d,b);h=0;$('#playerName').remove();$('#playerNameCell').text(b)}return false}})}}else{console.warn('AJAX call by loadHighscore() returned: '+result)}},error(xhr,status,code){console.warn('AJAX call by loadHighscore() returned: '+status+': '+code);$('.msg').html(k)}})};this.saveHighscore=function(a,b){a=(typeof(a)!=='undefined')?a:h;b=(typeof(b)!=='undefined')?b:'Player';var d='Highscore not saved!';var c={'action':'saveScore','player':b,'score':a};var g=JSON.stringify(c);var f=Base64.encode(g);$.ajax({url:'php/backend.php',type:'POST',data:'data='+f,success(result){if(result=='OK'){d='Highscore saved!'}else{m={force2d:v,music:j,highscore:a};wade.storeLocalObject(G.data,m)}$('.msg').html(d)},error(xhr,status,code){console.warn('saveHighscore() returned: '+status+': '+code);$('.msg').html(d)}})};this.handleMouseMove=function(a,b,d){var c=a.getPosition();var g=a.getSprite();var f=null;if(c.x<0){if(c.x>d.screenPosition.x){f=new Animation(b.flyLeft,5,1,30)}else if(c.x<d.screenPosition.x){f=new Animation(b.flyRight,5,1,30)}}else if(c.x>0){if(c.x<d.screenPosition.x){f=new Animation(b.flyRight,5,1,30)}else if(c.x>d.screenPosition.x){f=new Animation(b.flyLeft,5,1,30)}}if(f!==null){g.addAnimation('fly',f);a.playAnimation('fly');a.onAnimationEnd=function(){g.setImageFile(b.ship)}}return a&&a.setPosition(d.screenPosition.x,d.screenPosition.y)};this.startGame=function(){console.log('Re-enabling quadtree optimizations.');wade.useQuadtree(E,true);var L=new Sprite(e.ship);var o=wade.getMousePosition();n=new SceneObject(L,0,o.x,o.y);wade.addSceneObject(n);wade.setMainLoop(function(){P=O;if(wade.isMouseDown(2)&&sissy){P=50}var a=bc+1/P;var b=wade.getAppTime();if((wade.isMouseDown(0)||wade.isMouseDown(2)||(wade.isMouseDown()&&(W||bb)))&&b>=a){bc=b;var d=n.getPosition();var c=n.getSprite().getSize();var g=new Sprite(e.shipBullet);var f=new SceneObject(g,0,d.x,d.y-c.y/2);wade.addSceneObject(f);wade.playAudio(r.shoot,false);B.push(f);f.moveTo(d.x,-500,600);f.onMoveComplete=function(){wade.removeSceneObject(this);wade.removeObjectFromArray(this,B)};if(h>0&&!sissy&&P<60){h-=10}if(h<0||h==='NaN'){h=0}}if(B.length>0){for(var k=B.length-1;k>=0;k--){var i=B[k].getOverlappingObjects();if(i.length>0){for(var l=0;l<i.length;l++){if(i[l].isEnemy){var t=i[l].getPosition();wade.app.explosion(t,1);wade.playAudio(r.hit,false);if(i[l].health>0){i[l].health-=J}if(i[l].health<=0){wade.app.explosion(t,2);wade.playAudio(r.explode,false);wade.removeSceneObject(i[l]);h+=Math.floor(i[l].initialHealth/10)*s}wade.removeSceneObject(B[k]);wade.removeObjectFromArrayByIndex(k,B);break}}}}}if(Math.floor(h/Q)>s-1&&s<5){Q=Q*Math.pow(10,s);s+=1;if(!sissy){q=100}if(K>200){K-=100}if(A>400){A-=100}if(O<50){O+=1}if(J<600){J+=(s*10)}}R.getSprite().setText(q);ba.getSprite().setText(s);Z.getSprite().setText(Math.floor(h)+', Left: '+(Q-Math.floor(h)))},'fire');wade.setMainLoop(function(){var a=n.getOverlappingObjects(false,'axis-aligned');var b=false;var d=1;if(a.length>0){for(var c=0;c<a.length;c++){if(typeof(a[c])!=='undefined'){if(a[c].isEnemy||a[c].isEnemyBullet){if(typeof(a[c])!=='undefined'&&n.overlapsObject(a[c],'pixel')){if(a[c].health>0){a[c].health-=Math.floor(J/10)}if(typeof(a[c])!=='undefined'&&(a[c].isEnemyBullet||a[c].health<=0)){wade.removeSceneObject(a[c]);wade.removeObjectFromArrayByIndex(c,a)}if(typeof(a[c])!=='undefined'){d=a[c].damage||d}b=true;break}}}}}if(b){b=false;wade.app.explosion(n.getPosition(),0);wade.playAudio(r.hit,false);if(q>0){q-=d}if(q<0||q==='NaN'){q=0}R.getSprite().setText(q)}if(q<=0){var g=wade.app.explosion(n.getPosition(),2);wade.playAudio(r.explode,false);wade.removeSceneObject(n);wade.setMainLoop(null,'fire');wade.setMainLoop(null,'die');if(!sissy&&h>D){m={force2d:v,music:j,highscore:h};wade.storeLocalObject(G.data,m)}var f=setInterval(function(){if(!g.isPlaying()){u=false;if(j){wade.app.musicOn()}clearInterval(f);clearTimeout(F);clearTimeout(w);wade.clearScene();wade.app.init()}},100)}},'die');if(!u){if(sissy){q=999}else{q=100}h=0;s=1;O=4;J=200;u=true;if(j){wade.app.musicOn()}}var M=new Sprite(e.scoreIcon);var N=new SceneObject(M,0,wade.getScreenWidth()/2-20,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(N);var V=new TextSprite(h.toString(),'32pt Highspeed','#f88','right');Z=new SceneObject(V,0,wade.getScreenWidth()/2-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(Z);var x=new Sprite(e.healthIcon);var H=new SceneObject(x,0,-120,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(H);var p=new TextSprite(q.toString(),'32pt Highspeed','#f88','center');R=new SceneObject(p,0,-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(R);var bf=new Sprite(e.levelIcon);var bg=new SceneObject(bf,0,20-(wade.getScreenWidth()/2),-12-wade.getScreenHeight()/2+30);wade.addSceneObject(bg);var bh=new TextSprite(s,'32pt Highspeed','#f88','left');ba=new SceneObject(bh,0,40-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(ba);F=setTimeout(wade.app.spawnEnemy,K);w=setTimeout(wade.app.spawnAsteroid,A)};this.pauseGame=function(){clearTimeout(w);wade.app.musicOff();if(u&&!y){y=true;clearTimeout(F);wade.app.onMouseMove=null;wade.addSceneObject(I);U.style.cursor='default'}wade.pauseSimulation();return false};this.onKeyDown=function(b){if(u&&b.keyCode===32){if(!y){console.log('Game paused by user.');wade.app.pauseGame();y=true}else{y=false;console.log('Game resumed by user.');U.style.cursor='none';F=setTimeout(wade.app.spawnEnemy,K);w=setTimeout(wade.app.spawnAsteroid,A);wade.removeSceneObject(I);if(j){wade.app.musicOn()}wade.resumeSimulation();wade.app.onMouseMove=function(a){if(typeof(n)!=='undefined'){wade.app.handleMouseMove(n,e,a)}}}}return false};this.onMouseMove=function(a){if(typeof(n)!=='undefined'){return wade.app.handleMouseMove(n,e,a)}};this.explosion=function(a,b){if(typeof(b)==='undefined'||b===null||typeof(e.boom[b])==='undefined'){b=0}var d=new Animation(e.boom[b].file,e.boom[b].x,e.boom[b].y,e.boom[b].speed);var c=new Sprite();c.setSize(100,100);c.addAnimation('boom',d);var g=new SceneObject(c,0,a.x,a.y);wade.addSceneObject(g);g.playAnimation('boom');g.onAnimationEnd=function(){wade.removeSceneObject(this)};return d};this.getRandomCoords=function(a){return{x1:(Math.random()-0.5)*wade.getScreenWidth(),y1:-wade.getScreenHeight()/2-a.getSize().y/2,x2:(Math.random()-0.5)*wade.getScreenWidth(),y2:Math.abs(wade.getScreenHeight()/2-a.getSize().y/2)}};this.getRandomInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};this.spawnAsteroid=function(){if(y){return false}var a;var b=wade.app.getRandomInt(0,9);a=new Sprite(e.asteroids[b]);var d=wade.app.getRandomCoords(a);var c=new SceneObject(a,0,d.x1,d.y1);wade.addSceneObject(c);c.moveTo(d.x2,d.y2,200);c.isEnemy=true;c.isAsteroid=true;c.health=Y[b];c.initialHealth=Y[b];c.damage=Math.floor(Y[b]/100);c.onMoveComplete=function(){wade.removeSceneObject(this)};w=setTimeout(wade.app.spawnAsteroid,A)};this.spawnEnemy=function(){if(y){return false}var M;var N=s-1;var V=Object.keys(e.enemies).length-1;if(N>V){N=V}var x=wade.app.getRandomInt(0,N);M=new Sprite(e.enemies[x]);var H=wade.app.getRandomCoords(M);var p=new SceneObject(M,0,H.x1,H.y1);wade.addSceneObject(p);p.moveTo(H.x2,H.y2,200);p.isEnemy=true;p.isAsteroid=false;p.health=X[x];p.initialHealth=X[x];p.damage=Math.floor(X[x]/100);p.onMoveComplete=function(){wade.removeSceneObject(this)};p.originalStep=p.step;p.step=function(){this.originalStep();var a=this.getPosition();var b=n.getPosition();var d=Math.atan2(b.y-a.y,b.x-a.x)-3.14/2;this.setRotation(d)};p.fire=function(){var a=this.getSprite().getSize();var b=this.getPosition();var d=n.getPosition();var c=d.x-b.x;var g=d.y-b.y;var f=Math.sqrt(c*c+g*g);c/=f;g/=f;var k=b.x+c*a.x/2;var i=b.y+g*a.y/2;var l=k+c*3000;var t=i+g*3000;var L=new Sprite(e.enemyBullets[x].file);var o=new SceneObject(L,0,k,i);o.isEnemyBullet=true;o.damage=e.enemyBullets[x].damage;wade.addSceneObject(o);o.moveTo(l,t,200);o.onMoveComplete=function(){wade.removeSceneObject(this)};this.schedule(e.enemyBullets[x].delay,'fire')};p.schedule(300,'fire');F=setTimeout(wade.app.spawnEnemy,K)};this.toggleRenderer=function(){v=!v;m={force2d:v,music:j,highscore:D};wade.storeLocalObject(G.data,m);clearTimeout(F);clearTimeout(w);wade.setMainLoop(null,'fire');wade.setMainLoop(null,'die');u=false;wade.clearScene();wade.app.init()};this.musicOn=function(){if(C>-1){wade.stopAudio(C)}else{wade.stopAudio()}if(u){C=wade.playAudio(r.loop,true)}else{C=wade.playAudio(r.menu,true)}if(C<0){z.removeClass('music-on');z.addClass('music-off');T.title='Enable music';j=false}return false};this.musicOff=function(){if(C>-1){wade.stopAudio(C)}else{wade.stopAudio()}return false};this.toggleMusic=function(){var a=wade.getWebAudioContext();if(a.state=='suspended'){a.resume().then(()=>{console.log('Audio context resumed.')})}if(j){j=false;z.removeClass('music-on');z.addClass('music-off');T.title='Enable music';wade.app.musicOff()}else{j=true;z.removeClass('music-off');z.addClass('music-on');T.title='Disable music';wade.app.musicOn()}m={force2d:v,music:j,highscore:D};wade.storeLocalObject(G.data,m);return false}};