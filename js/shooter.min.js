var cheat=false;var App=function(){var b;var a=false;var w=false;var v=null;var k=0;var l=4;var o=4;var s=200;var j=[400,800,1200,1600];var m=2000;var d;var r=[200,200,200,300,400,400,600,500,400,600];var p=1000;var f;var g=[];var t;var n=0;var u;var q=100;var e;var c=1;var h={logo:"../img/logo.png",ship:"../img/ship.png",boom:{0:{file:"../img/animations/explode_4x4_ship.png",speed:30,x:4,y:4},1:{file:"../img/animations/explode_4x4_ring.png",speed:30,x:4,y:4},2:{file:"../img/animations/explode_5x3_enemy.png",speed:30,x:5,y:3}},bullet:"../img/bullets/bullet2.png",enemyBullet:"../img/bullets/bullet3.png",enemies:{0:"../img/enemies/enemy0.png",1:"../img/enemies/enemy1.png",2:"../img/enemies/enemy2.png",3:"../img/enemies/enemy3.png"},asteroids:{0:"../img/asteroids/asteroid0.png",1:"../img/asteroids/asteroid1.png",2:"../img/asteroids/asteroid2.png",3:"../img/asteroids/asteroid3.png",4:"../img/asteroids/asteroid4.png",5:"../img/asteroids/asteroid5.png",6:"../img/asteroids/asteroid6.png",7:"../img/asteroids/asteroid7.png",8:"../img/asteroids/asteroid8.png",9:"../img/asteroids/asteroid9.png"},healthIcon:"../img/icons/heart.png",levelIcon:"../img/icons/star.png",scoreIcon:"../img/icons/trophy.png"};var i={shoot:"../sounds/shoot.mp3",hit:"../sounds/hit.mp3",explode:"../sounds/explode.mp3"};this.load=function(){wade.loadImage(h.logo);wade.loadImage(h.ship);wade.loadImage(h.bullet);wade.loadImage(h.enemyBullet);for(var x=0;x<Object.keys(h.boom).length;x++){wade.loadImage(h.boom[x].file)}wade.loadImage(h.healthIcon);wade.loadImage(h.levelIcon);wade.loadImage(h.scoreIcon);for(var x=0;x<Object.keys(h.enemies).length;x++){wade.loadImage(h.enemies[x])}for(var x=0;x<Object.keys(h.asteroids).length;x++){wade.loadImage(h.asteroids[x])}wade.loadAudio(i.shoot);wade.loadAudio(i.hit);wade.loadAudio(i.explode)};this.init=function(){var D=wade.retrieveLocalObject("shooterData");var y=(D&&D.oldHighScore)||0;var J=(D&&D.newHighScore)||0;var A=document.getElementById("game");var C=document.getElementById("game-icons");var K=y;var B="overkill_highscore";var G=getCookie(B);if(typeof(G)!="undefined"&&G!=null){if(G>y){y=G}}if(J>y){K=J}wade.setMinScreenSize($(window).width(),$(window).height());console.log("Screen size set to: "+$(window).width()+"x"+$(window).height());var H=new TextSprite("Insert coin","36pt Highspeed","white","center");H.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,H.draw));var E=new SceneObject();E.addSprite(H,{y:320});if(n>0){var I="scored";if(cheat){I="cheated"}E.addSprite(new TextSprite("You "+I+" "+n+" points","24pt Highspeed","white","center"),{y:120});if(J>y){var z="New Highscore";if(cheat){z+=" not saved"}z+="!";var F=new TextSprite(z,"24pt Highspeed","yellow","center");E.addSprite(F,{y:160})}}if(n<=0||y>=J){E.addSprite(new TextSprite("Highscore is "+K+" points","24pt Highspeed","yellow","center"),{y:160})}if(!cheat){setCookie(B,K,365);D={oldHighScore:K,newHighScore:J};wade.storeLocalObject("shooterData",D)}E.addSprite(new Sprite(h.logo),{y:-200});C.style.display="block";game.style.cursor="default";wade.addSceneObject(E);v=new SceneObject();var x=new TextSprite("PAUSED","32pt Highspeed","yellow","center");x.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,x.draw));v.addSprite(new Sprite(h.logo),{y:-200});v.addSprite(x,{y:160});f=setTimeout(wade.app.spawnAsteroid,p);wade.app.onMouseDown=function(){if(wade.isMouseDown("0")){clearTimeout(f);wade.removeSceneObject(E);wade.clearScene();wade.app.startGame();wade.app.onMouseDown=0;C.style.display="none";game.style.cursor="none"}}};this.startGame=function(){var E=new Sprite(h.ship);var H=wade.getMousePosition();b=new SceneObject(E,0,H.x,H.y);wade.addSceneObject(b);wade.setMainLoop(function(){o=l;if(wade.isMouseDown("2")&&cheat){o=50}var Q=k+1/o;var J=wade.getAppTime();if((wade.isMouseDown("0")||wade.isMouseDown("2"))&&J>=Q){k=J;var L=b.getPosition();var O=b.getSprite().getSize();var R=new Sprite(h.bullet);var I=new SceneObject(R,0,L.x,L.y-O.y/2);wade.addSceneObject(I);wade.playAudio(i.shoot,false);g.push(I);I.moveTo(L.x,-500,600);I.onMoveComplete=function(){wade.removeSceneObject(this);wade.removeObjectFromArray(this,g)};if(n>0&&!cheat&&o<60){n-=10}if(n<0){n=0}}if(g.length>0){for(var M=g.length-1;M>=0;M--){var P=g[M].getOverlappingObjects();if(P.length>0){for(var K=0;K<P.length;K++){if(P[K].isEnemy){var N=P[K].getPosition();wade.app.explosion(N,1);wade.playAudio(i.hit,false);if(P[K].health>0){P[K].health-=s}if(P[K].health<=0){wade.app.explosion(N,2);wade.playAudio(i.explode,false);wade.removeSceneObject(P[K]);n+=Math.floor(P[K].initialHealth/10)}wade.removeSceneObject(g[M]);wade.removeObjectFromArrayByIndex(M,g);break}}}}}if(Math.floor(n/1000)>c){c+=1;q+=10;if(m>200){m-=100}if(p>400){p-=100}if(l<50){l+=1}if(s<600){s+=(c*10)}}u.getSprite().setText(q);e.getSprite().setText(c);t.getSprite().setText(Math.floor(n))},"fire");wade.setMainLoop(function(){var I=b.getOverlappingObjects(false,"axis-aligned");var N=false;if(I.length>0){for(var L=0;L<I.length;L++){if(I[L].isEnemy||I[L].isEnemyBullet){if(b.overlapsObject(I[L],"pixel")){if(I[L].health>0){I[L].health-=Math.floor(s/10)}if(I[L].isEnemyBullet||I[L].health<=0){wade.removeSceneObject(I[L]);wade.removeObjectFromArrayByIndex(L,I)}N=true;break}}}}if(N){N=false;wade.app.explosion(b.getPosition(),0);wade.playAudio(i.hit,false);if(q>0){q--}u.getSprite().setText(q);if(q<=0){wade.app.explosion(b.getPosition(),2);wade.playAudio(i.explode,false);wade.removeSceneObject(b);wade.setMainLoop(null,"fire");wade.setMainLoop(null,"die");var J=wade.retrieveLocalObject("shooterData");var M=(J&&J.oldHighScore)||0;if(n>M){J={oldHighScore:M,newHighScore:n};wade.storeLocalObject("shooterData",J)}var K=setTimeout(function(){w=false;wade.clearScene();wade.app.init();clearTimeout(d);clearTimeout(f)},250)}}},"die");if(!w){if(cheat){q=999}else{q=100}n=0;c=1;w=true}var C=new Sprite(h.scoreIcon);var D=new SceneObject(C,0,wade.getScreenWidth()/2-20,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(D);var F=new TextSprite(n.toString(),"32pt Highspeed","#f88","right");t=new SceneObject(F,0,wade.getScreenWidth()/2-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(t);var y=new Sprite(h.healthIcon);var z=new SceneObject(y,0,-120,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(z);var G=new TextSprite(q.toString(),"32pt Highspeed","#f88","center");u=new SceneObject(G,0,-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(u);var A=new Sprite(h.levelIcon);var x=new SceneObject(A,0,20-(wade.getScreenWidth()/2),-12-wade.getScreenHeight()/2+30);wade.addSceneObject(x);var B=new TextSprite(c,"32pt Highspeed","#f88","left");e=new SceneObject(B,0,40-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(e);d=setTimeout(wade.app.spawnEnemy,m);f=setTimeout(wade.app.spawnAsteroid,p)};$(window).blur(function(){if(w&&!a){a=true;wade.pauseSimulation();clearTimeout(d);clearTimeout(f);wade.app.onMouseMove=null;wade.addSceneObject(v);game.style.cursor="default"}else{if(!w){clearTimeout(f)}}return false});$(window).focus(function(){if(!w){f=setTimeout(wade.app.spawnAsteroid,p)}});this.onKeyDown=function(x){if(w&&x.keyCode==32){a=!a;if(a){wade.pauseSimulation();clearTimeout(d);clearTimeout(f);wade.app.onMouseMove=null;wade.addSceneObject(v);game.style.cursor="default"}else{game.style.cursor="none";d=setTimeout(wade.app.spawnEnemy,m);f=setTimeout(wade.app.spawnAsteroid,p);wade.removeSceneObject(v);wade.resumeSimulation();wade.app.onMouseMove=function(y){b&&b.setPosition(y.screenPosition.x,y.screenPosition.y)}}}return false};this.onMouseMove=function(x){b&&b.setPosition(x.screenPosition.x,x.screenPosition.y)};this.explosion=function(y,z){if(typeof(z)=="undefined"||z==null||typeof(h.boom[z])=="undefined"){z=0}var A=new Animation(h.boom[z].file,h.boom[z].x,h.boom[z].y,h.boom[z].speed);var x=new Sprite();x.setSize(100,100);x.addAnimation("boom",A);var B=new SceneObject(x,0,y.x,y.y);wade.addSceneObject(B);B.playAnimation("boom");B.onAnimationEnd=function(){wade.removeSceneObject(this)}};this.spawnAsteroid=function(){var A;var C=getRandomInt(0,9);A=new Sprite(h.asteroids[C]);var y=(Math.random()-0.5)*wade.getScreenWidth();var D=(Math.random()-0.5)*wade.getScreenWidth();var x=-wade.getScreenHeight()/2-A.getSize().y/2;var B=-x;var z=new SceneObject(A,0,y,x);wade.addSceneObject(z);z.moveTo(D,B,200);z.isEnemy=true;z.isAsteroid=true;z.health=r[C];z.initialHealth=r[C];z.onMoveComplete=function(){wade.removeSceneObject(this)};f=setTimeout(wade.app.spawnAsteroid,p)};this.spawnEnemy=function(){var A;var D=getRandomInt(0,3);A=new Sprite(h.enemies[D]);var z=(Math.random()-0.5)*wade.getScreenWidth();var C=(Math.random()-0.5)*wade.getScreenWidth();var x=-wade.getScreenHeight()/2-A.getSize().y/2;var B=-x;var y=new SceneObject(A,0,z,x);wade.addSceneObject(y);y.moveTo(C,B,200);y.isEnemy=true;y.isAsteroid=false;y.health=j[D];y.initialHealth=j[D];y.onMoveComplete=function(){wade.removeSceneObject(this)};y.originalStep=y.step;y.step=function(){this.originalStep();var E=this.getPosition();var F=b.getPosition();var G=Math.atan2(F.y-E.y,F.x-E.x)-3.14/2;this.setRotation(G)};y.fire=function(){var O=this.getSprite().getSize();var K=this.getPosition();var I=b.getPosition();var P=I.x-K.x;var N=I.y-K.y;var F=Math.sqrt(P*P+N*N);P/=F;N/=F;var H=K.x+P*O.x/2;var G=K.y+N*O.y/2;var M=H+P*3000;var L=G+N*3000;var J=new Sprite(h.enemyBullet);var E=new SceneObject(J,0,H,G);E.isEnemyBullet=true;wade.addSceneObject(E);E.moveTo(M,L,200);E.onMoveComplete=function(){wade.removeSceneObject(this)};this.schedule(600,"fire")};y.schedule(300,"fire");d=setTimeout(wade.app.spawnEnemy,m)}};function getRandomInt(b,a){return Math.floor(Math.random()*(a-b+1))+b};