const version='1.0.4';$('#version').text(version);var cheat=false;var App=function(){'use strict';var E=E||false;var i;var F=false;var u=false;var B=null;var q=false;var S=1;var bb=0;var G=4;var L=4;var C=200;var T=[400,600,800,1500,5000];var H=2000;var y;var U=[200,200,200,300,400,400,600,500,400,600];var z=1000;var p;var A=[];var V;var h=0;var D={data:'overkill',};var M;var n=100;var W;var r=1;var v=null;var o=false;var j=wade.retrieveLocalObject(D.data);var s=(j&&j.highscore)||0;const images={logo:'../img/logo.png',ship:'../img/ship.png',boom:{0:{file:'../img/animations/explosion/explode_4x4_ship.png',speed:30,x:4,y:4},1:{file:'../img/animations/explosion/explode_4x4_ring.png',speed:30,x:4,y:4},2:{file:'../img/animations/explosion/explode_5x3_enemy.png',speed:30,x:5,y:3}},fly_left:'../img/animations/ship/fly_left.png',fly_right:'../img/animations/ship/fly_right.png',shipBullet:'../img/bullets/bullet_ship.png',enemyBullets:{0:{file:'../img/bullets/bullet0.png',delay:600,damage:1},1:{file:'../img/bullets/bullet1.png',delay:500,damage:3},2:{file:'../img/bullets/bullet2.png',delay:400,damage:5},3:{file:'../img/bullets/bullet3.png',delay:300,damage:10},4:{file:'../img/bullets/bullet4.png',delay:200,damage:20}},enemies:{0:'../img/enemies/enemy0.png',1:'../img/enemies/enemy1.png',2:'../img/enemies/enemy2.png',3:'../img/enemies/enemy3.png',4:'../img/enemies/enemy4.png'},asteroids:{0:'../img/asteroids/asteroid0.png',1:'../img/asteroids/asteroid1.png',2:'../img/asteroids/asteroid2.png',3:'../img/asteroids/asteroid3.png',4:'../img/asteroids/asteroid4.png',5:'../img/asteroids/asteroid5.png',6:'../img/asteroids/asteroid6.png',7:'../img/asteroids/asteroid7.png',8:'../img/asteroids/asteroid8.png',9:'../img/asteroids/asteroid9.png'},healthIcon:'../img/icons/heart.png',levelIcon:'../img/icons/star.png',scoreIcon:'../img/icons/trophy.png'};const sounds={shoot:'../sounds/shoot.mp3',hit:'../sounds/hit.mp3',explode:'../sounds/explode.mp3',loop:'../sounds/loop.mp3'};var bc=document.getElementById('toggleRendererTitle');var N=$('#toggleRendererBtn');var O=document.getElementById('toggleMusicTitle');var w=$('#toggleMusicBtn');var I=document.getElementById('game');var bd=document.getElementById('game-icons');wade.preventIframe();wade.setLoadingBar(true,{x:0,y:0},'#333333','#222222');wade.setLoadingImages('../img/loading.svg');this.load=function(){wade.loadImage(images.logo);wade.loadImage(images.ship);wade.loadImage(images.shipBullet);for(var a=0;a<Object.keys(images.enemyBullets).length;a++){wade.loadImage(images.enemyBullets[a].file)}for(var a=0;a<Object.keys(images.boom).length;a++){wade.loadImage(images.boom[a].file)}wade.loadImage(images.fly_left);wade.loadImage(images.fly_right);wade.loadImage(images.healthIcon);wade.loadImage(images.levelIcon);wade.loadImage(images.scoreIcon);for(var a=0;a<Object.keys(images.enemies).length;a++){wade.loadImage(images.enemies[a])}for(var a=0;a<Object.keys(images.asteroids).length;a++){wade.loadImage(images.asteroids[a])}wade.loadAudio(sounds.shoot);wade.loadAudio(sounds.hit);wade.loadAudio(sounds.explode);wade.loadAudio(sounds.loop)};this.init=function(){j=wade.retrieveLocalObject(D.data);q=(j&&j.force2d)||q;if(q){wade.setLayerRenderMode(S,'2d');N.removeClass('fa-toggle-on');N.addClass('fa-toggle-off');bc.title='Enable WebGL'}else{wade.setLayerRenderMode(S,'webgl');N.removeClass('fa-toggle-off');N.addClass('fa-toggle-on');bc.title='Disable WebGL'}if(wade.isWebAudioSupported()){o=(j&&j.music)||o;if(o){w.removeClass('music-off');w.addClass('music-on');O.title='Disable music'}}else{o=false}wade.setMinScreenSize($(window).width(),$(window).height());wade.setMaxScreenSize($(window).width(),$(window).height());wade.setResolutionFactor(1);if(E){wade.setMinScreenSize($(window).width()*3,$(window).height()*3);wade.setMaxScreenSize($(window).width()*3,$(window).height()*3);wade.setResolutionFactor(0.5)}var a=wade.getLayerRenderMode(S);if(debug){log('\n\t\tbrowser screen size   : '+$(window).width()+'x'+$(window).height()+'\n\t\tactual min screen size: '+wade.getMinScreenWidth()+'x'+wade.getMinScreenHeight()+'\n\t\tactual max screen size: '+wade.getMaxScreenWidth()+'x'+wade.getMaxScreenHeight()+'\n\t\trender-mode           : '+a+'\n\t\tforce2D               : '+q+'\n\t\tisMobile              : '+E+'\n\t\tisCheater             : '+cheat+'\n\t\tcurrent score         : '+h+'\n\t\thighscore             : '+s+'\n\t\tlevel                 : '+r+'\n\t\tplayer health         : '+n+'\n\t\tfire rate             : '+G+'\n\t\tfire damage           : '+C)}var b={insertCoin:'- INSERT COIN -',highscoreIs:'HIGHSCORE IS %i POINTS',youScored:'YOU %s %i POINTS'};if(a=='webgl'){b=padStrings(b)}var d=new TextSprite(b.insertCoin,'36pt Highspeed','white','center');d.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,d.draw));var c=new SceneObject();c.addSprite(d,{y:320});if(h<=0||s>=h){b.highscoreIs=b.highscoreIs.replace('%i',s);c.addSprite(new TextSprite(b.highscoreIs,'24pt Highspeed','yellow','center'),{y:160})}if(h>0){var g='SCORED';if(cheat){g='CHEATED'}var e=b.youScored.replace('%s',g);e=e.replace('%i',h);if(a=='webgl'){e=padStrings(e)}c.addSprite(new TextSprite(e,'24pt Highspeed','white','center'),{y:120});if(h>s){var f='NEW HIGHSCORE';s=h;if(cheat){f+=' NOT SAVED'}f+='!';if(a=='webgl'){f=padStrings(f)}var m=new TextSprite(f,'24pt Highspeed','yellow','center');c.addSprite(m,{y:160})}}if(!cheat){j={force2d:q,music:o,highscore:s};wade.storeLocalObject(D.data,j)}c.addSprite(new Sprite(images.logo),{y:-200});B=new SceneObject();var k=new TextSprite('PAUSED','32pt Highspeed','yellow','center');k.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,k.draw));B.addSprite(new Sprite(images.logo),{y:-200});B.addSprite(k,{y:160});bd.style.display='block';I.style.cursor='default';wade.addSceneObject(c);p=setTimeout(wade.app.spawnAsteroid,z);if(wade.isWebAudioSupported()){if(o&&v===null){v=wade.playAudio(sounds.loop,true);if(v<0){w.removeClass('music-on');w.addClass('music-off');O.title='Enable music';o=false}}}wade.app.onMouseDown=function(){if(wade.isMouseDown(0)||(wade.isMouseDown()&&E)){bd.style.display='none';I.style.cursor='none';clearTimeout(p);wade.removeSceneObject(c);wade.clearScene();wade.removeUnusedLayers([1]);wade.app.startGame();wade.app.onMouseDown=0}}};this.startGame=function(){var X=new Sprite(images.ship);var x=wade.getMousePosition();i=new SceneObject(X,0,x.x,x.y);wade.addSceneObject(i);wade.setMainLoop(function(){L=G;if(wade.isMouseDown(2)&&cheat){L=50}var a=bb+1/L;var b=wade.getAppTime();if((wade.isMouseDown(0)||wade.isMouseDown(2)||(wade.isMouseDown()&&E))&&b>=a){bb=b;var d=i.getPosition();var c=i.getSprite().getSize();var g=new Sprite(images.shipBullet);var e=new SceneObject(g,0,d.x,d.y-c.y/2);wade.addSceneObject(e);wade.playAudio(sounds.shoot,false);A.push(e);e.moveTo(d.x,-500,600);e.onMoveComplete=function(){wade.removeSceneObject(this);wade.removeObjectFromArray(this,A)};if(h>0&&!cheat&&L<60){h-=10}if(h<0||h=='NaN'){h=0}}if(A.length>0){for(var f=A.length-1;f>=0;f--){var m=A[f].getOverlappingObjects();if(m.length>0){for(var k=0;k<m.length;k++){if(m[k].isEnemy){var P=m[k].getPosition();wade.app.explosion(P,1);wade.playAudio(sounds.hit,false);if(m[k].health>0){m[k].health-=C}if(m[k].health<=0){wade.app.explosion(P,2);wade.playAudio(sounds.explode,false);wade.removeSceneObject(m[k]);h+=Math.floor(m[k].initialHealth/10)*r}wade.removeSceneObject(A[f]);wade.removeObjectFromArrayByIndex(f,A);break}}}}}if(Math.floor(h/1000)>r-1&&r<5){r+=1;if(!cheat){n=100}if(H>200){H-=100}if(z>400){z-=100}if(G<50){G+=1}if(C<600){C+=(r*10)}}M.getSprite().setText(n);W.getSprite().setText(r);V.getSprite().setText(Math.floor(h))},'fire');wade.setMainLoop(function(){var a=i.getOverlappingObjects(false,'axis-aligned');var b=false;var d=1;if(a.length>0){for(var c=0;c<a.length;c++){if(typeof(a[c])!='undefined'){if(a[c].isEnemy||a[c].isEnemyBullet){if(typeof(a[c])!='undefined'&&i.overlapsObject(a[c],'pixel')){if(a[c].health>0){a[c].health-=Math.floor(C/10)}if(typeof(a[c])!='undefined'&&(a[c].isEnemyBullet||a[c].health<=0)){wade.removeSceneObject(a[c]);wade.removeObjectFromArrayByIndex(c,a)}if(typeof(a[c])!='undefined'){d=a[c].damage||d}b=true;break}}}}}if(b){b=false;wade.app.explosion(i.getPosition(),0);wade.playAudio(sounds.hit,false);if(n>0){n-=d}if(n<0||n=='NaN'){n=0}M.getSprite().setText(n)}if(n<=0){var g=wade.app.explosion(i.getPosition(),2);wade.playAudio(sounds.explode,false);wade.removeSceneObject(i);wade.setMainLoop(null,'fire');wade.setMainLoop(null,'die');if(!cheat&&h>s){j={force2d:q,music:o,highscore:h};wade.storeLocalObject(D.data,j)}var e=setInterval(function(){if(!g.isPlaying()){u=false;clearInterval(e);clearTimeout(y);clearTimeout(p);wade.clearScene();wade.app.init()}},100)}},'die');if(!u){if(cheat){n=999}else{n=100}h=0;r=1;G=4;C=200;u=true}var J=new Sprite(images.scoreIcon);var K=new SceneObject(J,0,wade.getScreenWidth()/2-20,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(K);var Q=new TextSprite(h.toString(),'32pt Highspeed','#f88','right');V=new SceneObject(Q,0,wade.getScreenWidth()/2-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(V);var t=new Sprite(images.healthIcon);var Y=new SceneObject(t,0,-120,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(Y);var Z=new TextSprite(n.toString(),'32pt Highspeed','#f88','center');M=new SceneObject(Z,0,-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(M);var R=new Sprite(images.levelIcon);var ba=new SceneObject(R,0,20-(wade.getScreenWidth()/2),-12-wade.getScreenHeight()/2+30);wade.addSceneObject(ba);var l=new TextSprite(r,'32pt Highspeed','#f88','left');W=new SceneObject(l,0,40-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(W);y=setTimeout(wade.app.spawnEnemy,H);p=setTimeout(wade.app.spawnAsteroid,z)};$(window).blur(function(){if(u&&!F){console.log('Game paused due to focus loss.');F=true;wade.pauseSimulation();clearTimeout(y);clearTimeout(p);wade.app.onMouseMove=null;wade.addSceneObject(B);I.style.cursor='default'}else{if(!u){console.log('Asteroid timeout cleared due to focus loss.');clearTimeout(p)}}return false});$(window).focus(function(){if(!u){p=setTimeout(wade.app.spawnAsteroid,z)}});this.onKeyDown=function(b){if(u&&b.keyCode==32){F=!F;if(F){wade.pauseSimulation();clearTimeout(y);clearTimeout(p);wade.app.onMouseMove=null;wade.addSceneObject(B);I.style.cursor='default'}else{I.style.cursor='none';y=setTimeout(wade.app.spawnEnemy,H);p=setTimeout(wade.app.spawnAsteroid,z);wade.removeSceneObject(B);wade.resumeSimulation();wade.app.onMouseMove=function(a){if(typeof(i)!='undefined'){handleMouseMove(i,images,a)}}}}return false};this.onMouseMove=function(a){if(typeof(i)!='undefined'){return handleMouseMove(i,images,a)}};this.explosion=function(a,b){if(typeof(b)=='undefined'||b===null||typeof(images.boom[b])=='undefined'){b=0}var d=new Animation(images.boom[b].file,images.boom[b].x,images.boom[b].y,images.boom[b].speed);var c=new Sprite();c.setSize(100,100);c.addAnimation('boom',d);var g=new SceneObject(c,0,a.x,a.y);wade.addSceneObject(g);g.playAnimation('boom');g.onAnimationEnd=function(){wade.removeSceneObject(this)};return d};this.spawnAsteroid=function(){var a;var b=getRandomInt(0,9);a=new Sprite(images.asteroids[b]);var d=(Math.random()-0.5)*wade.getScreenWidth();var c=(Math.random()-0.5)*wade.getScreenWidth();var g=-wade.getScreenHeight()/2-a.getSize().y/2;var e=-g;var f=new SceneObject(a,0,d,g);wade.addSceneObject(f);f.moveTo(c,e,200);f.isEnemy=true;f.isAsteroid=true;f.health=U[b];f.initialHealth=U[b];f.damage=Math.floor(U[b]/100);f.onMoveComplete=function(){wade.removeSceneObject(this)};p=setTimeout(wade.app.spawnAsteroid,z)};this.spawnEnemy=function(){var J;var K=r-1;var Q=Object.keys(images.enemies).length-1;if(K>Q){K=Q}var t=getRandomInt(0,K);J=new Sprite(images.enemies[t]);var Y=(Math.random()-0.5)*wade.getScreenWidth();var Z=(Math.random()-0.5)*wade.getScreenWidth();var R=-wade.getScreenHeight()/2-J.getSize().y/2;var ba=-R;var l=new SceneObject(J,0,Y,R);wade.addSceneObject(l);l.moveTo(Z,ba,200);l.isEnemy=true;l.isAsteroid=false;l.health=T[t];l.initialHealth=T[t];l.damage=Math.floor(T[t]/100);l.onMoveComplete=function(){wade.removeSceneObject(this)};l.originalStep=l.step;l.step=function(){this.originalStep();var a=this.getPosition();var b=i.getPosition();var d=Math.atan2(b.y-a.y,b.x-a.x)-3.14/2;this.setRotation(d)};l.fire=function(){var a=this.getSprite().getSize();var b=this.getPosition();var d=i.getPosition();var c=d.x-b.x;var g=d.y-b.y;var e=Math.sqrt(c*c+g*g);c/=e;g/=e;var f=b.x+c*a.x/2;var m=b.y+g*a.y/2;var k=f+c*3000;var P=m+g*3000;var X=new Sprite(images.enemyBullets[t].file);var x=new SceneObject(X,0,f,m);x.isEnemyBullet=true;x.damage=images.enemyBullets[t].damage;wade.addSceneObject(x);x.moveTo(k,P,200);x.onMoveComplete=function(){wade.removeSceneObject(this)};this.schedule(images.enemyBullets[t].delay,'fire')};l.schedule(300,'fire');y=setTimeout(wade.app.spawnEnemy,H)};this.toggleRenderer=function(){q=!q;j={force2d:q,music:o,highscore:s};wade.storeLocalObject(D.data,j);clearTimeout(y);clearTimeout(p);wade.setMainLoop(null,'fire');wade.setMainLoop(null,'die');u=false;wade.clearScene();wade.app.init()};this.toggleMusic=function(){if(wade.isWebAudioSupported()){if(o){if(v>-1){wade.stopAudio(v)}else{wade.stopAudio()}o=false;w.removeClass('music-on');w.addClass('music-off');O.title='Enable music'}else{if(v>-1){wade.stopAudio(v)}else{wade.stopAudio()}v=wade.playAudio(sounds.loop,true);o=true;w.removeClass('music-off');w.addClass('music-on');O.title='Disable music'}j={force2d:q,music:o,highscore:s};wade.storeLocalObject(D.data,j)}}};function getRandomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}function padStrings(a){var b='       ';var d;if(typeof(a)=='object'){d={};for(var c in a){d[c]=b+a[c]+b}}else{d=b+a+b}return d}function handleMouseMove(a,b,d){var c=a.getPosition();var g=a.getSprite();var e=null;if(c.x<0){if(c.x>d.screenPosition.x){e=new Animation(b.fly_left,5,1,30)}else if(c.x<d.screenPosition.x){e=new Animation(b.fly_right,5,1,30)}}else if(c.x>0){if(c.x<d.screenPosition.x){e=new Animation(b.fly_right,5,1,30)}else if(c.x>d.screenPosition.x){e=new Animation(b.fly_left,5,1,30)}}if(e!==null){g.addAnimation('fly',e);a.playAnimation('fly');a.onAnimationEnd=function(){g.setImageFile(b.ship)}}return a&&a.setPosition(d.screenPosition.x,d.screenPosition.y)}