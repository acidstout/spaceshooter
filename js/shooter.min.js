/*! Space shooter, (C) 2019 Nils Rekow, GPL-3, http://www.gnu.org/licenses/ */
var version='1.2';var App=function(){'use strict';var bg=false||checkForMobileDevice();var bk=false||getBrowserVersion('Trident/([0-9]{1,}[.0-9]{0,})');var r;var z=false;var A=false;var R=null;var B=false;var N=1;var bl=0;var W=4;var X=4;var S=200;var bo=1000;var u={missiles:{fired:0,hit:0},bullets:{fired:-1,hit:0}};var bh=[400,600,800,1500,5000];var O=2000;var P;var bi=[200,200,200,300,400,400,600,500,400,600];var C=1000;var D;var E={cannister:{images:['../img/powerups/cannister0.png','../img/powerups/cannister1.png','../img/powerups/cannister2.png'],values:[100,1000,10000],name:'cannister'},heart:{images:['../img/powerups/heart0.png','../img/powerups/heart1.png','../img/powerups/heart2.png'],values:[5,10,20],name:'heart'},missiles:{images:['../img/powerups/missiles0.png','../img/powerups/missiles1.png','../img/powerups/missiles2.png'],values:[25,50,100],name:'missiles'},shield:{images:['../img/powerups/shield0.png','../img/powerups/shield1.png','../img/powerups/shield2.png'],values:[4,7,10],name:'shield'},targeting:{images:['../img/powerups/targeting0.png','../img/powerups/targeting1.png','../img/powerups/targeting2.png'],values:[10,20,30],name:'targeting'}};var J=[];var y=0;var v=0;var s=0;var Y;var k=0;var T=1000;var Q={data:'overkill'};var Z;var ba;var bb;var U;var t=100;var bj;var w=1;var K=null;var n=false;var p=wade.retrieveLocalObject(Q.data);const sissy=(p&&p.sissy)||false;var L=(p&&p.highscore)||0;var f={logo:'../img/logo.png',ship:'../img/ship.png',boom:{0:{file:'../img/animations/explosion/explode_4x4_ship.png',speed:30,x:4,y:4},1:{file:'../img/animations/explosion/explode_4x4_ring.png',speed:30,x:4,y:4},2:{file:'../img/animations/explosion/explode_5x3_enemy.png',speed:30,x:5,y:3}},flyLeft:'../img/animations/ship/fly_left.png',flyRight:'../img/animations/ship/fly_right.png',shipBullet:'../img/bullets/bullet_ship.png',shipMissile:'../img/bullets/missile_ship.png',enemyBullets:{0:{file:'../img/bullets/bullet0.png',delay:600,damage:1},1:{file:'../img/bullets/bullet1.png',delay:500,damage:3},2:{file:'../img/bullets/bullet2.png',delay:400,damage:5},3:{file:'../img/bullets/bullet3.png',delay:300,damage:10},4:{file:'../img/bullets/bullet4.png',delay:200,damage:20}},enemies:{0:'../img/enemies/enemy0.png',1:'../img/enemies/enemy1.png',2:'../img/enemies/enemy2.png',3:'../img/enemies/enemy3.png',4:'../img/enemies/enemy4.png'},asteroids:{0:'../img/asteroids/asteroid0.png',1:'../img/asteroids/asteroid1.png',2:'../img/asteroids/asteroid2.png',3:'../img/asteroids/asteroid3.png',4:'../img/asteroids/asteroid4.png',5:'../img/asteroids/asteroid5.png',6:'../img/asteroids/asteroid6.png',7:'../img/asteroids/asteroid7.png',8:'../img/asteroids/asteroid8.png',9:'../img/asteroids/asteroid9.png'},healthIcon:'../img/icons/heart.png',levelIcon:'../img/icons/star.png',scoreIcon:'../img/icons/trophy.png',missilesIcon:'../img/icons/missiles.png',shieldsIcon:'../img/icons/shields.png',targetingIcon:'../img/icons/targeting.png'};var o={shoot:'../sounds/shoot.mp3',missile:'../sounds/missile.mp3',hit:'../sounds/hit.mp3',explode:'../sounds/explode.mp3',loop:'../sounds/loop.mp3',menu:'../sounds/menu.mp3',spawn:'../sounds/spawn.mp3',powerup:'../sounds/powerup.mp3'};var bm=document.getElementById('toggleRendererTitle');var bc=$('#toggleRendererBtn');var bd=document.getElementById('toggleMusicTitle');var H=$('#toggleMusicBtn');var be=document.getElementById('game');var bn=document.getElementById('game-icons');$('#version').text(version+', WADE '+wade.getVersion());$(window).blur(function(){if(A&&!z){console.log('Game paused due to focus loss.')}wade.app.pauseGame()});$(window).focus(function(){if(!A){console.log('Game resumed due to focus gain.');D=wade.setTimeout(wade.app.spawnAsteroid,C);if(n){wade.app.musicOn()}wade.resumeSimulation()}});wade.preventIframe();wade.setLoadingBar(true,{x:0,y:0},'#333333','#222222');wade.setLoadingImages('../img/loading.svg');this.padStrings=function(a){var b='       ';var d;if(typeof(a)==='object'){d={};for(var c in a){if({}.hasOwnProperty.call(a,c)){d[c]=b+a[c]+b}}}else{d=b+a+b}return d};this.load=function(){var b=0;for(b=0;b<Object.keys(f.asteroids).length;b++){wade.loadImage(f.asteroids[b])}wade.loadImage(f.logo);for(b=0;b<Object.keys(f.boom).length;b++){wade.loadImage(f.boom[b].file)}wade.loadImage(f.shipBullet);wade.loadImage(f.shipMissile);for(b=0;b<Object.keys(f.enemyBullets).length;b++){wade.loadImage(f.enemyBullets[b].file)}for(b=0;b<Object.keys(f.enemies).length;b++){wade.loadImage(f.enemies[b])}Object.keys(E).forEach(function(a){for(b=0;b<E[a].images.length;b++){wade.loadImage(E[a].images[b])}});wade.loadImage(f.ship);wade.loadImage(f.flyLeft);wade.loadImage(f.flyRight);wade.loadImage(f.healthIcon);wade.loadImage(f.levelIcon);wade.loadImage(f.scoreIcon);wade.loadImage(f.missilesIcon);wade.loadImage(f.shieldsIcon);wade.loadImage(f.targetingIcon);var d=wade.isWebAudioSupported()?'loadAudio':'preloadAudio';wade[d](o.shoot);wade[d](o.missile);wade[d](o.hit);wade[d](o.explode);wade[d](o.loop);wade[d](o.menu);wade[d](o.spawn);wade[d](o.powerup);var c=null;c=setInterval(function(){console.log('Loaded '+Math.round(wade.getLoadingPercentage())+'% of data.');if(wade.getLoadingPercentage()>=100){clearInterval(c)}},1000)};this.init=function(){p=wade.retrieveLocalObject(Q.data);B=(p&&p.force2d)||B;wade.setLayerRenderMode(N,'2d');wade.useQuadtree(N,false);bc.removeClass('fa-toggle-on');bc.addClass('fa-toggle-off');bm.title='Enable WebGL';if(!B){wade.setLayerRenderMode(N,'webgl');bc.removeClass('fa-toggle-off');bc.addClass('fa-toggle-on');bm.title='Disable WebGL'}if(wade.isWebAudioSupported()){n=(p&&p.music)||n;if(wade.getWebAudioContext().state==='suspended'){n=false}if(n){H.removeClass('music-off');H.addClass('music-on');bd.title='Disable music'}}else{n=false}wade.setMinScreenSize($(window).width(),$(window).height());wade.setMaxScreenSize($(window).width(),$(window).height());wade.setResolutionFactor(1);if(bg){wade.setMinScreenSize($(window).width()*3,$(window).height()*3);wade.setMaxScreenSize($(window).width()*3,$(window).height()*3);wade.setResolutionFactor(0.5)}var a=wade.getLayerRenderMode(N);var b={insertCoin:'- INSERT COIN -',highscoreIs:'HIGHSCORE IS %i POINTS',youScored:'YOU %s %i POINTS'};if(a==='webgl'){b=wade.app.padStrings(b)}var d=new TextSprite(b.insertCoin,'36pt Highspeed','white','center');d.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,d.draw));var c=new SceneObject();c.addSprite(d,{y:320});wade.app.getHighestScore(k,c,b);if(k>0){var g=Base64.decode('U0NPUkVE');if(sissy){g=Base64.decode('Q0hFQVRFRA==')}else{$('#highscoreWrapper').fadeToggle();wade.app.loadHighscore(k)}var h=b.youScored.replace('%s',g);h=h.replace('%i',k);if(a==='webgl'){h=wade.app.padStrings(h)}c.addSprite(new TextSprite(h,'24pt Highspeed','white','center'),{y:120});if(k>L){var i=Base64.decode('TkVXIEhJR0hTQ09SRQ==');L=k;k=0;if(sissy){i+=Base64.decode('IE5PVCBTQVZFRA==')}i+='!';if(a==='webgl'){i=wade.app.padStrings(i)}var l=new TextSprite(i,'24pt Highspeed','yellow','center');c.addSprite(l,{y:160})}}c.addSprite(new Sprite(f.logo),{y:-200});R=new SceneObject();var j=new TextSprite('PAUSED','32pt Highspeed','yellow','center');j.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,j.draw));R.addSprite(new Sprite(f.logo),{y:-200});R.addSprite(j,{y:160});bn.style.display='block';be.style.cursor='default';wade.addSceneObject(c);var m=null;m=setInterval(function(){if(wade.getLoadingPercentage()>=100){console.log('Initializing asteroids on main screen.');D=wade.setTimeout(wade.app.spawnAsteroid,C);clearInterval(m)}},1000);if(n){wade.app.musicOn()}wade.app.onMouseDown=function(){if(wade.isMouseDown(0)||(wade.isMouseDown()&&(bg||bk))){bn.style.display='none';be.style.cursor='none';T=1000;C=1000;O=1000;u={missiles:{fired:0,hit:0},bullets:{fired:-1,hit:0}};wade.clearTimeout(D);wade.removeSceneObject(c);wade.clearScene();wade.removeUnusedLayers([1]);wade.clearCanvas(N);wade.app.onMouseDown=0;wade.app.startGame()}}};this.getHighestScore=function(i,l,j){var m=setInterval(function(){var c={'action':'getHighestScore'};var g=JSON.stringify(c);var h=Base64.encode(g);$.ajax({url:'php/backend.php',type:'POST',headers:{'Csrf-Token':$('meta[name="csrf-token"]').attr('content')},data:'data='+h,success:function(a){if(a===null||a===''||a==='FAILED'){a=L}if(i<=0||a>i){j.highscoreIs=j.highscoreIs.replace('%i',a);l.addSprite(new TextSprite(j.highscoreIs,'24pt Highspeed','yellow','center'),{y:160})}L=a;clearInterval(m)},error:function(a,b,d){console.warn('getHighestScore(): AJAX call returned: '+b+': '+d)}})},1000)};this.loadHighscore=function(j){var m={'action':'loadScore'};var M=JSON.stringify(m);var F=Base64.encode(M);var G='Couldn\'t get highscore :(';j=(typeof(j)!=='undefined')?j:k;$.ajax({url:'php/backend.php',type:'POST',headers:{'Csrf-Token':$('meta[name="csrf-token"]').attr('content')},data:'data='+F,success:function(d){if(d!=='FAILED'){var c='';var g='<tr><td id="playerNameCell"><input type="text" class="highscore" id="playerName" maxlength="20" value="" placeholder="Enter your name"/></td><td>'+j+'</td></tr>';var h=null;try{h=JSON.parse(d)}catch(e){console.warn('Decoding AJAX response failed: '+e.message);$('#highscoreTable').html('<tr><td colspan="2">'+G+'</td></tr>')}if(h!==null){var i=Object.keys(h).length;var l=false;$.each(h,function(a,b){if(j>0&&j>=b.score&&!l){c+=g;l=true}if(a<9||!l){c+='<tr><td>'+b.player+'</td><td>'+b.score+'</td></tr>'}});if(i<10&&!l&&j>0){c+=g;l=true}$('#highscoreTable').html(c);if(l){$('#playerName').focus();$('#playerName').on('keypress',function(a){if(a.keyCode===13){a.preventDefault();var b=$('#playerName').val();if(b.length>0){$(this).prop('disabled',true);wade.app.saveHighscore(j,b);k=0;$('#playerName').remove();$('#playerNameCell').text(b)}return false}})}}}else{console.warn('AJAX call by loadHighscore() returned: '+d);$('#highscoreTable').html('<tr><td colspan="2">'+G+'</td></tr>')}},error:function(a,b,d){console.warn('AJAX call by loadHighscore() returned: '+b+': '+d);$('#highscoreTable').html('<tr><td colspan="2">'+G+'</td></tr>')}})};this.saveHighscore=function(c,g){c=(typeof(c)!=='undefined')?c:k;g=(typeof(g)!=='undefined')?g:'Player';var h={'action':'saveScore','player':g,'score':c};var i=JSON.stringify(h);var l=Base64.encode(i);$.ajax({url:'php/backend.php',type:'POST',headers:{'Csrf-Token':$('meta[name="csrf-token"]').attr('content')},data:'data='+l,success:function(a){if(a!=='OK'){p={force2d:B,music:n,highscore:c};wade.storeLocalObject(Q.data,p)}},error:function(a,b,d){console.warn('saveHighscore() returned: '+b+': '+d)}})};this.handleMouseMove=function(a,b,d){var c=a.getPosition();var g=a.getSprite();var h=null;if(c.x<0){if(c.x>d.screenPosition.x){h=new Animation(b.flyLeft,5,1,30)}else if(c.x<d.screenPosition.x){h=new Animation(b.flyRight,5,1,30)}}else if(c.x>0){if(c.x<d.screenPosition.x){h=new Animation(b.flyRight,5,1,30)}else if(c.x>d.screenPosition.x){h=new Animation(b.flyLeft,5,1,30)}}if(h!==null){g.addAnimation('fly',h);a.playAnimation('fly');a.onAnimationEnd=function(){g.setImageFile(b.ship)}}return a&&a.setPosition(d.screenPosition.x,d.screenPosition.y)};this.startGame=function(){console.log('Re-enabling quadtree optimizations.');wade.useQuadtree(N,true);var bf=new Sprite(f.ship);var x=wade.getMousePosition();r=new SceneObject(bf,0,x.x,x.y);wade.addSceneObject(r);var I=false;wade.setMainLoop(function(){X=W;if(wade.isMouseDown(2)&&sissy){X=50}var a=bl+1/X;var b=wade.getAppTime();if((wade.isMouseDown(0)||wade.isMouseDown(2)||(wade.isMouseDown()&&(bg||bk)))&&b>=a){bl=b;var d=r.getPosition();var c=r.getSprite().getSize();var g;var h;if(v>0){u.missiles.fired++;v--;h=o.missile;g=new Sprite(f.shipMissile);I=true}else{u.bullets.fired++;h=o.shoot;g=new Sprite(f.shipBullet);I=false}var i=new SceneObject(g,0,d.x,d.y-c.y/2);wade.addSceneObject(i);wade.playAudio(h,false);J.push(i);i.moveTo(d.x,-500,600);i.onMoveComplete=function(){wade.removeSceneObject(this);wade.removeObjectFromArray(this,J)};if(k>0&&!sissy&&X<60){k-=10}if(k<0||k==='NaN'){k=0}}if(J.length>0){for(var l=J.length-1;l>=0;l--){var j=J[l].getOverlappingObjects();if(j.length>0){for(var m=0;m<j.length;m++){if(j[m].isEnemy){if(v>0){u.missiles.hit++}else{u.bullets.hit++}var M=j[m].getPosition();wade.app.explosion(M,1);wade.playAudio(o.hit,false);if(j[m].health>0){if(I){j[m].health-=bo}else{j[m].health-=S}}if(j[m].health<=0){wade.app.explosion(M,2);wade.playAudio(o.explode,false);var F=j[m].isAsteroid;wade.removeSceneObject(j[m]);k+=Math.floor(j[m].initialHealth/10)*w;var G=wade.app.getRandomInt(0,9);var V=[4,9];if(F&&V.indexOf(G)>-1){wade.app.spawnPowerUp(M)}}wade.removeSceneObject(J[l]);wade.removeObjectFromArrayByIndex(l,J);break}}}}}if(Math.floor(k/T)>0){if(k>=T){w+=1;T=Math.pow(10,w+2)}if(!sissy){t+=100}if(O>200){O-=100}if(C>400){C-=100}if(w>=5){C=200}if(W<50){W+=1}if(S<600){S+=(w*10)}}Z.getSprite().setText(t);bj.getSprite().setText(w);ba.getSprite().setText(v);if(w>=5){Y.getSprite().setText(Math.floor(k)+' / OVERKILL!')}else{Y.getSprite().setText(Math.floor(k)+' / '+(T-Math.floor(k)))}bb.getSprite().setText(y);U.getSprite().setText(s)},'fire');wade.setMainLoop(function(){var a=r.getOverlappingObjects(false,'axis-aligned');var b=false;var d=1;if(a.length>0){for(var c=0;c<a.length;c++){if(typeof(a[c])!=='undefined'){if(a[c].isEnemy||a[c].isEnemyBullet||a[c].isPowerUp){if(r.overlapsObject(a[c],'pixel')){if(a[c].isPowerUp){wade.playAudio(o.powerup,false);switch(a[c].name){case'cannister':k+=a[c].initialValue;break;case'heart':t+=a[c].initialValue;break;case'missiles':if(v<250){v+=a[c].initialValue}break;case'shield':if(y<100){y+=a[c].initialValue}break;case'targeting':if(s<10){s+=a[c].initialValue}break}wade.removeSceneObject(a[c]);wade.removeObjectFromArrayByIndex(c,a);b=false;break}if(a[c].health>0){a[c].health-=Math.floor(S/10)}d=a[c].damage||d;if(a[c].isEnemyBullet||a[c].health<=0){wade.removeSceneObject(a[c]);wade.removeObjectFromArrayByIndex(c,a)}b=true;break}}}b=false}}if(b){b=false;wade.app.explosion(r.getPosition(),0);wade.playAudio(o.hit,false);if(t>0){if(y>0){y-=d}else{t-=d}}if(y<0||y==='NaN'){y=0}if(t<0||t==='NaN'){t=0}if(v<0||v==='NaN'){v=0}if(s<0||s==='NaN'){s=0}Z.getSprite().setText(t);ba.getSprite().setText(v);bb.getSprite().setText(y);U.getSprite().setText(s)}if(t<=0){var g=wade.app.explosion(r.getPosition(),2);wade.playAudio(o.explode,false);wade.removeSceneObject(r);wade.setMainLoop(null,'fire');wade.setMainLoop(null,'die');var h=(u.bullets.fired==0)?0:Math.round((u.bullets.hit/u.bullets.fired)*100);var i=(u.missiles.fired==0)?0:Math.round((u.missiles.hit/u.missiles.fired)*100);var l=(h+i)*100;l=Math.max(Math.round(l/1000)*1000,1000);k+=l;if(!sissy&&k>L){p={force2d:B,music:n,highscore:k};wade.storeLocalObject(Q.data,p)}var j=setInterval(function(){if(!g.isPlaying()){A=false;if(n){wade.app.musicOn()}wade.clearTimeout(P);wade.clearTimeout(D);clearInterval(j);wade.clearScene();wade.app.init()}},100)}},'die');if(!A){if(sissy){t=999}else{t=100}k=0;w=1;W=4;S=200;A=true;if(n){wade.app.musicOn()}}var q=new Sprite(f.levelIcon);var bp=new SceneObject(q,0,20-(wade.getScreenWidth()/2),-12-wade.getScreenHeight()/2+30);wade.addSceneObject(bp);var bq=new TextSprite(w,'32pt Highspeed','#f88','left');bj=new SceneObject(bq,0,40-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(bj);var br=new Sprite(f.targetingIcon);var bs=new SceneObject(br,0,110-(wade.getScreenWidth()/2),-10-wade.getScreenHeight()/2+30);wade.addSceneObject(bs);var bt=new TextSprite(s.toString(),'32pt Highspeed','#f88','center');U=new SceneObject(bt,0,170-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(U);var bu=new Sprite(f.missilesIcon);var bv=new SceneObject(bu,0,250-(wade.getScreenWidth()/2),-10-wade.getScreenHeight()/2+30);wade.addSceneObject(bv);var bw=new TextSprite(v.toString(),'32pt Highspeed','#f88','center');ba=new SceneObject(bw,0,310-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(ba);var bx=new Sprite(f.shieldsIcon);var by=new SceneObject(bx,0,390-(wade.getScreenWidth()/2),-10-wade.getScreenHeight()/2+30);wade.addSceneObject(by);var bz=new TextSprite(y.toString(),'32pt Highspeed','#f88','center');bb=new SceneObject(bz,0,450-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(bb);var bA=new Sprite(f.healthIcon);var bB=new SceneObject(bA,0,-120,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(bB);var bC=new TextSprite(t.toString(),'32pt Highspeed','#f88','center');Z=new SceneObject(bC,0,-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(Z);var bD=new Sprite(f.scoreIcon);var bE=new SceneObject(bD,0,wade.getScreenWidth()/2-20,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(bE);var bF=new TextSprite(k.toString(),'32pt Highspeed','#f88','right');Y=new SceneObject(bF,0,wade.getScreenWidth()/2-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(Y);P=wade.setTimeout(wade.app.spawnEnemy,O);D=wade.setTimeout(wade.app.spawnAsteroid,C)};this.pauseGame=function(){wade.clearTimeout(D);wade.app.musicOff();if(A&&!z){z=true;wade.clearTimeout(P);wade.app.onMouseMove=null;wade.addSceneObject(R);be.style.cursor='default'}wade.pauseSimulation()};this.onKeyDown=function(b){if(A&&b.keyCode===32){if(!z){console.log('Game paused by user.');wade.app.pauseGame();z=true}else{z=false;console.log('Game resumed by user.');be.style.cursor='none';P=wade.setTimeout(wade.app.spawnEnemy,O);D=wade.setTimeout(wade.app.spawnAsteroid,C);wade.removeSceneObject(R);if(n){wade.app.musicOn()}wade.resumeSimulation();wade.app.onMouseMove=function(a){if(typeof(r)!=='undefined'){wade.app.handleMouseMove(r,f,a)}}}}return false};this.onMouseMove=function(a){if(typeof(r)!=='undefined'){return wade.app.handleMouseMove(r,f,a)}};this.explosion=function(a,b){if(typeof(b)==='undefined'||b===null||typeof(f.boom[b])==='undefined'){b=0}var d=new Animation(f.boom[b].file,f.boom[b].x,f.boom[b].y,f.boom[b].speed);var c=new Sprite();c.setSize(100,100);c.addAnimation('boom',d);var g=new SceneObject(c,0,a.x,a.y);wade.addSceneObject(g);g.playAnimation('boom');g.onAnimationEnd=function(){wade.removeSceneObject(this)};return d};this.getRandomCoords=function(a){return{x1:(Math.random()-0.5)*wade.getScreenWidth(),y1:-wade.getScreenHeight()/2-a.getSize().y/2,x2:(Math.random()-0.5)*wade.getScreenWidth(),y2:Math.abs(wade.getScreenHeight()/2-a.getSize().y/2)}};this.getRandomInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};this.spawnPowerUp=function(a){var b;var d=wade.app.getRandomInt(0,2);var c=wade.app.getRandomInt(0,4);var g;switch(c){case 1:g=E.heart;break;case 2:g=E.missiles;break;case 3:g=E.shield;break;case 4:g=E.targeting;break;default:g=E.cannister;break}if(g!==E.targeting||s<=0){b=new Sprite(g.images[d]);var h=wade.app.getRandomCoords(b);var i=new SceneObject(b,0,a.x,a.y);wade.addSceneObject(i);i.moveTo(h.x2,h.y2,200);i.isEnemy=false;i.isAsteroid=false;i.isPowerUp=true;i.initialValue=g.values[d];i.name=g.name;i.damage=0;wade.playAudio(o.spawn,false);i.onMoveComplete=function(){wade.removeSceneObject(this)}}};this.spawnAsteroid=function(){console.log('spawnAsteroid, Game paused = '+z);if(z){return false}var a;var b=wade.app.getRandomInt(0,9);a=new Sprite(f.asteroids[b]);var d=wade.app.getRandomCoords(a);var c=new SceneObject(a,0,d.x1,d.y1);wade.addSceneObject(c);c.moveTo(d.x2,d.y2,200);c.isEnemy=true;c.isAsteroid=true;c.isPowerUp=false;c.health=bi[b];c.initialHealth=bi[b];c.damage=Math.floor(bi[b]/100);c.onMoveComplete=function(){wade.removeSceneObject(this)};D=wade.setTimeout(wade.app.spawnAsteroid,C)};this.spawnEnemy=function(){if(z){return false}var G;var V=w-1;var bf=Object.keys(f.enemies).length-1;if(V>bf){V=bf}var x=wade.app.getRandomInt(0,V);if(w>=5){x=4}G=new Sprite(f.enemies[x]);var I=wade.app.getRandomCoords(G);var q=new SceneObject(G,0,I.x1,I.y1);wade.addSceneObject(q);q.moveTo(I.x2,I.y2,200);q.isEnemy=true;q.isAsteroid=false;q.isPowerUp=false;q.health=bh[x];q.initialHealth=bh[x];q.damage=Math.floor(bh[x]/100);q.onMoveComplete=function(){wade.removeSceneObject(this)};q.originalStep=q.step;q.step=function(){this.originalStep();var a=this.getPosition();var b=r.getPosition();var d=Math.atan2(b.y-a.y,b.x-a.x)-3.14/2;this.setRotation(d)};q.fire=function(){var a=this.getSprite().getSize();var b=this.getPosition();var d=r.getPosition();var c=d.x-b.x;var g=d.y-b.y;var h=Math.sqrt(c*c+g*g);c/=h;g/=h;var i=b.x+c*a.x/2;var l=b.y+g*a.y/2;var j=i+c*3000;var m=l+g*3000;var M=new Sprite(f.enemyBullets[x].file);var F=new SceneObject(M,0,i,l);F.isEnemyBullet=true;F.damage=f.enemyBullets[x].damage;wade.addSceneObject(F);F.moveTo(j,m,200);F.onMoveComplete=function(){wade.removeSceneObject(this)};this.schedule(f.enemyBullets[x].delay,'fire')};if(s>0){wade.setTimeout(function(){s--;if(s<0||s==='NaN'){s=0}U.getSprite().setText(s)},1000)}else{q.schedule(300,'fire')}P=wade.setTimeout(wade.app.spawnEnemy,O)};this.toggleRenderer=function(){B=!B;p={force2d:B,music:n,highscore:L};wade.storeLocalObject(Q.data,p);wade.clearTimeout(P);wade.clearTimeout(D);wade.setMainLoop(null,'fire');wade.setMainLoop(null,'die');A=false;wade.clearScene();wade.app.init()};this.musicOn=function(){if(K>-1){wade.stopAudio(K)}else{wade.stopAudio()}if(A){K=wade.playAudio(o.loop,true)}else{K=wade.playAudio(o.menu,true)}if(K<0){H.removeClass('music-on');H.addClass('music-off');bd.title='Enable music';n=false}return false};this.musicOff=function(){if(K>-1){wade.stopAudio(K)}else{wade.stopAudio()}return false};this.toggleMusic=function(){var a=wade.getWebAudioContext();if(a.state==='suspended'){a.resume().then(function(){console.log('Audio context resumed.')})}if(n){n=false;H.removeClass('music-on');H.addClass('music-off');bd.title='Enable music';wade.app.musicOff()}else{n=true;H.removeClass('music-off');H.addClass('music-on');bd.title='Disable music';wade.app.musicOn()}p={force2d:B,music:n,highscore:L};wade.storeLocalObject(Q.data,p);return false}};