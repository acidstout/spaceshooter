var cheat=false;var App=function(){var a;var j=0;var k=4;var n=4;var r=200;var i=[400,800,1200,1600];var l=2000;var c;var q=[200,200,400,400,400,600,800];var o=1000;var e;var f=[];var s;var m=0;var t;var p=100;var d;var b=1;var g={logo:"../img/logo.png",ship:"../img/ship.png",boom:"../img/animations/boom.png",bullet:"../img/bullets/bullet0.png",enemyBullet:"../img/bullets/bullet1.png",enemy0:"../img/enemies/enemy0.png",enemy1:"../img/enemies/enemy1.png",enemy2:"../img/enemies/enemy2.png",enemy3:"../img/enemies/enemy3.png",asteroid0:"../img/asteroids/asteroid0.png",asteroid1:"../img/asteroids/asteroid1.png",asteroid2:"../img/asteroids/asteroid2.png",asteroid3:"../img/asteroids/asteroid3.png",asteroid4:"../img/asteroids/asteroid4.png",asteroid5:"../img/asteroids/asteroid5.png",asteroid6:"../img/asteroids/asteroid6.png",healthIcon:"../img/icons/heart.png",levelIcon:"../img/icons/star.png",scoreIcon:"../img/icons/trophy.png"};var h={shoot:"../sounds/shoot.mp3",hit:"../sounds/hit.mp3",explode:"../sounds/explode.mp3"};this.load=function(){wade.loadImage(g.logo);wade.loadImage(g.ship);wade.loadImage(g.bullet);wade.loadImage(g.enemyBullet);wade.loadImage(g.enemy0);wade.loadImage(g.enemy1);wade.loadImage(g.enemy2);wade.loadImage(g.enemy3);wade.loadImage(g.asteroid0);wade.loadImage(g.asteroid1);wade.loadImage(g.asteroid2);wade.loadImage(g.asteroid3);wade.loadImage(g.asteroid4);wade.loadImage(g.asteroid5);wade.loadImage(g.asteroid6);wade.loadImage(g.boom);wade.loadImage(g.healthIcon);wade.loadImage(g.levelIcon);wade.loadImage(g.scoreIcon);wade.loadAudio(h.shoot);wade.loadAudio(h.hit);wade.loadAudio(h.explode)};this.init=function(){var z=wade.retrieveLocalObject("shooterData");var u=(z&&z.oldHighScore)||0;var F=(z&&z.newHighScore)||0;var w=document.getElementById("game");var y=document.getElementById("game-icons");var G=u;var x="overkill_highscore";var C=getCookie(x);if(typeof(C)!="undefined"&&C!=null){if(C>u){u=C}}if(F>u){G=F}var D=new TextSprite("Insert coin","36pt Highspeed","white","center");D.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,D.draw));var A=new SceneObject(D);if(m>0){var E="scored";if(cheat){E="cheated"}A.addSprite(new TextSprite("You "+E+" "+m+" points","24pt Highspeed","white","center"),{y:180});if(F>u){var v="New Highscore";if(cheat){v+=" not saved"}v+="!";var B=new TextSprite(v,"24pt Highspeed","yellow","center");B.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,B.draw));A.addSprite(B,{y:140})}}if(m<=0||u>=F){A.addSprite(new TextSprite("Highscore is "+G+" points","24pt Highspeed","yellow","center"),{y:140})}if(!cheat){setCookie(x,G,365);z={oldHighScore:G,newHighScore:F};wade.storeLocalObject("shooterData",z)}A.addSprite(new Sprite(g.logo),{y:-200});y.style.display="block";game.style.cursor="default";wade.addSceneObject(A);wade.app.onMouseDown=function(){wade.removeSceneObject(A);wade.app.startGame();wade.app.onMouseDown=0;y.style.display="none";game.style.cursor="none"}};this.startGame=function(){var B=new Sprite(g.ship);var E=wade.getMousePosition();a=new SceneObject(B,0,E.x,E.y);wade.addSceneObject(a);wade.setMainLoop(function(){n=k;if(wade.isMouseDown("2")&&cheat){n=50}var N=j+1/n;var G=wade.getAppTime();if(wade.isMouseDown()&&G>=N){j=G;var I=a.getPosition();var L=a.getSprite().getSize();var O=new Sprite(g.bullet);var F=new SceneObject(O,0,I.x,I.y-L.y/2);wade.addSceneObject(F);wade.playAudio(h.shoot,false);f.push(F);F.moveTo(I.x,-500,600);F.onMoveComplete=function(){wade.removeSceneObject(this);wade.removeObjectFromArray(this,f)};if(m>0&&!cheat&&n<60){m-=10}if(m<0){m=0}}if(f.length>0){for(var J=f.length-1;J>=0;J--){var M=f[J].getOverlappingObjects();if(M.length>0){for(var H=0;H<M.length;H++){if(M[H].isEnemy){var K=M[H].getPosition();wade.app.explosion(K);wade.playAudio(h.hit,false);if(M[H].health>0){M[H].health-=r}if(M[H].health<=0){wade.app.explosion(K);wade.playAudio(h.explode,false);wade.removeSceneObject(M[H]);m+=Math.floor(M[H].initialHealth/10)}wade.removeSceneObject(f[J]);wade.removeObjectFromArrayByIndex(J,f);break}}}}}if(Math.floor(m/1000)>b){b+=1;p+=10;if(l>200){l-=100}if(o>400){o-=100}if(k<50){k+=1}if(r<600){r+=(b*10)}}t.getSprite().setText(p);d.getSprite().setText(b);s.getSprite().setText(Math.floor(m))},"fire");wade.setMainLoop(function(){var F=a.getOverlappingObjects(false,"axis-aligned");var J=false;if(F.length>0){for(var H=0;H<F.length;H++){if(F[H].isEnemy||F[H].isEnemyBullet){if(a.overlapsObject(F[H],"pixel")){if(F[H].health>0){F[H].health-=Math.floor(r/10)}if(F[H].isEnemyBullet||F[H].health<=0){wade.removeSceneObject(F[H]);wade.removeObjectFromArrayByIndex(H,F)}J=true;break}}}}if(J){J=false;wade.app.explosion(a.getPosition());wade.playAudio(h.hit,false);p--;t.getSprite().setText(p);if(p<=0){wade.app.explosion(a.getPosition());wade.playAudio(h.explode,false);wade.removeSceneObject(a);wade.setMainLoop(null,"fire");wade.setMainLoop(null,"die");var G=wade.retrieveLocalObject("shooterData");var I=(G&&G.oldHighScore)||0;if(m>I){G={oldHighScore:I,newHighScore:m};wade.storeLocalObject("shooterData",G)}wade.clearScene();wade.app.init();clearTimeout(c);clearTimeout(e)}}},"die");if(cheat){p=999}else{p=100}m=0;b=1;var z=new Sprite(g.scoreIcon);var A=new SceneObject(z,0,wade.getScreenWidth()/2-20,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(A);var C=new TextSprite(m.toString(),"32pt Highspeed","#f88","right");s=new SceneObject(C,0,wade.getScreenWidth()/2-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(s);var v=new Sprite(g.healthIcon);var w=new SceneObject(v,0,-120,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(w);var D=new TextSprite(p.toString(),"32pt Highspeed","#f88","center");t=new SceneObject(D,0,-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(t);var x=new Sprite(g.levelIcon);var u=new SceneObject(x,0,20-(wade.getScreenWidth()/2),-12-wade.getScreenHeight()/2+30);wade.addSceneObject(u);var y=new TextSprite(b,"32pt Highspeed","#f88","left");d=new SceneObject(y,0,40-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(d);c=setTimeout(wade.app.spawnEnemy,l);e=setTimeout(wade.app.spawnAsteroid,o)};this.onMouseMove=function(u){a&&a.setPosition(u.screenPosition.x,u.screenPosition.y)};this.explosion=function(v){var w=new Animation(g.boom,6,4,30);var u=new Sprite();u.setSize(100,100);u.addAnimation("boom",w);var x=new SceneObject(u,0,v.x,v.y);wade.addSceneObject(x);x.playAnimation("boom");x.onAnimationEnd=function(){wade.removeSceneObject(this)}};this.spawnAsteroid=function(){var x;var z=getRandomInt(0,6);switch(z){case 1:x=new Sprite(g.asteroid1);break;case 2:x=new Sprite(g.asteroid2);break;case 3:x=new Sprite(g.asteroid3);break;case 4:x=new Sprite(g.asteroid4);break;case 5:x=new Sprite(g.asteroid5);break;case 6:x=new Sprite(g.asteroid6);break;default:x=new Sprite(g.asteroid0);break}var v=(Math.random()-0.5)*wade.getScreenWidth();var A=(Math.random()-0.5)*wade.getScreenWidth();var u=-wade.getScreenHeight()/2-x.getSize().y/2;var y=-u;var w=new SceneObject(x,0,v,u);wade.addSceneObject(w);w.moveTo(A,y,200);w.isEnemy=true;w.health=q[z];w.initialHealth=q[z];w.onMoveComplete=function(){wade.removeSceneObject(this)};e=setTimeout(wade.app.spawnAsteroid,o)};this.spawnEnemy=function(){var x;var A=getRandomInt(0,3);switch(A){case 1:x=new Sprite(g.enemy1);break;case 2:x=new Sprite(g.enemy2);break;case 3:x=new Sprite(g.enemy3);break;default:x=new Sprite(g.enemy0);break}var w=(Math.random()-0.5)*wade.getScreenWidth();var z=(Math.random()-0.5)*wade.getScreenWidth();var u=-wade.getScreenHeight()/2-x.getSize().y/2;var y=-u;var v=new SceneObject(x,0,w,u);wade.addSceneObject(v);v.moveTo(z,y,200);v.isEnemy=true;v.health=i[A];v.initialHealth=i[A];v.onMoveComplete=function(){wade.removeSceneObject(this)};v.originalStep=v.step;v.step=function(){this.originalStep();var B=this.getPosition();var C=a.getPosition();var D=Math.atan2(C.y-B.y,C.x-B.x)-3.14/2;this.setRotation(D)};v.fire=function(){var L=this.getSprite().getSize();var H=this.getPosition();var F=a.getPosition();var M=F.x-H.x;var K=F.y-H.y;var C=Math.sqrt(M*M+K*K);M/=C;K/=C;var E=H.x+M*L.x/2;var D=H.y+K*L.y/2;var J=E+M*3000;var I=D+K*3000;var G=new Sprite(g.enemyBullet);var B=new SceneObject(G,0,E,D);B.isEnemyBullet=true;wade.addSceneObject(B);B.moveTo(J,I,200);B.onMoveComplete=function(){wade.removeSceneObject(this)};this.schedule(600,"fire")};v.schedule(300,"fire");c=setTimeout(wade.app.spawnEnemy,l)}};function getRandomInt(b,a){return Math.floor(Math.random()*(a-b+1))+b};