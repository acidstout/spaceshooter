var version="1.1.9";var App=function(){var n=false||checkForMobileDevice();var u=false||getBrowserVersion("Trident/([0-9]{1,}[.0-9]{0,})");var J;var U=false;var p=false;var W=null;var Q=false;var T=1;var v=0;var R=4;var t=4;var w=200;var P=1000;var M={missiles:{fired:0,hit:0},bullets:{fired:-1,hit:0}};var G=[400,600,800,1500,5000];var N=2000;var F;var k=[200,200,200,300,400,400,600,500,400,600];var g=1000;var S;var b={cannister:{images:["../img/powerups/cannister0.png","../img/powerups/cannister1.png","../img/powerups/cannister2.png"],values:[100,1000,10000],name:"cannister"},heart:{images:["../img/powerups/heart0.png","../img/powerups/heart1.png","../img/powerups/heart2.png"],values:[5,10,20],name:"heart"},missiles:{images:["../img/powerups/missiles0.png","../img/powerups/missiles1.png","../img/powerups/missiles2.png"],values:[25,50,100],name:"missiles"},shield:{images:["../img/powerups/shield0.png","../img/powerups/shield1.png","../img/powerups/shield2.png"],values:[4,7,10],name:"shield"},targeting:{images:["../img/powerups/targeting0.png","../img/powerups/targeting1.png","../img/powerups/targeting2.png"],values:[10,20,30],name:"targeting"}};var A=[];var q=0;var D=0;var O=0;var I;var c=0;var y=1000;var i={data:"overkill"};var E;var f;var x;var V;var j=100;var m;var h=1;var a=null;var e=false;var L=wade.retrieveLocalObject(i.data);const z=(L&&L.sissy)||false;var o=(L&&L.highscore)||0;var d={logo:"../img/logo.png",ship:"../img/ship.png",boom:{0:{file:"../img/animations/explosion/explode_4x4_ship.png",speed:30,x:4,y:4},1:{file:"../img/animations/explosion/explode_4x4_ring.png",speed:30,x:4,y:4},2:{file:"../img/animations/explosion/explode_5x3_enemy.png",speed:30,x:5,y:3}},flyLeft:"../img/animations/ship/fly_left.png",flyRight:"../img/animations/ship/fly_right.png",shipBullet:"../img/bullets/bullet_ship.png",shipMissile:"../img/bullets/missile_ship.png",enemyBullets:{0:{file:"../img/bullets/bullet0.png",delay:600,damage:1},1:{file:"../img/bullets/bullet1.png",delay:500,damage:3},2:{file:"../img/bullets/bullet2.png",delay:400,damage:5},3:{file:"../img/bullets/bullet3.png",delay:300,damage:10},4:{file:"../img/bullets/bullet4.png",delay:200,damage:20}},enemies:{0:"../img/enemies/enemy0.png",1:"../img/enemies/enemy1.png",2:"../img/enemies/enemy2.png",3:"../img/enemies/enemy3.png",4:"../img/enemies/enemy4.png"},asteroids:{0:"../img/asteroids/asteroid0.png",1:"../img/asteroids/asteroid1.png",2:"../img/asteroids/asteroid2.png",3:"../img/asteroids/asteroid3.png",4:"../img/asteroids/asteroid4.png",5:"../img/asteroids/asteroid5.png",6:"../img/asteroids/asteroid6.png",7:"../img/asteroids/asteroid7.png",8:"../img/asteroids/asteroid8.png",9:"../img/asteroids/asteroid9.png"},healthIcon:"../img/icons/heart.png",levelIcon:"../img/icons/star.png",scoreIcon:"../img/icons/trophy.png",missilesIcon:"../img/icons/missiles.png",shieldsIcon:"../img/icons/shields.png",targetingIcon:"../img/icons/targeting.png"};var r={shoot:"../sounds/shoot.mp3",missile:"../sounds/missile.mp3",hit:"../sounds/hit.mp3",explode:"../sounds/explode.mp3",loop:"../sounds/loop.mp3",menu:"../sounds/menu.mp3",spawn:"../sounds/spawn.mp3",powerup:"../sounds/powerup.mp3"};var C=document.getElementById("toggleRendererTitle");var s=$("#toggleRendererBtn");var B=document.getElementById("toggleMusicTitle");var l=$("#toggleMusicBtn");var H=document.getElementById("game");var K=document.getElementById("game-icons");$("#version").text(version+", WADE "+wade.getVersion());$(window).blur(function(){if(p&&!U){console.log("Game paused due to focus loss.")}wade.app.pauseGame()});$(window).focus(function(){if(!p){console.log("Game resumed due to focus gain.");S=wade.setTimeout(wade.app.spawnAsteroid,g);if(e){wade.app.musicOn()}wade.resumeSimulation()}});wade.preventIframe();wade.setLoadingBar(true,{x:0,y:0},"#333333","#222222");wade.setLoadingImages("../img/loading.svg");this.padStrings=function(aa){var Z="       ";var Y;if(typeof(aa)==="object"){Y={};for(var X in aa){if({}.hasOwnProperty.call(aa,X)){Y[X]=Z+aa[X]+Z}}}else{Y=Z+aa+Z}return Y};this.load=function(){var X=0;for(X=0;X<Object.keys(d.asteroids).length;X++){wade.loadImage(d.asteroids[X])}wade.loadImage(d.logo);for(X=0;X<Object.keys(d.boom).length;X++){wade.loadImage(d.boom[X].file)}wade.loadImage(d.shipBullet);wade.loadImage(d.shipMissile);for(X=0;X<Object.keys(d.enemyBullets).length;X++){wade.loadImage(d.enemyBullets[X].file)}for(X=0;X<Object.keys(d.enemies).length;X++){wade.loadImage(d.enemies[X])}Object.keys(b).forEach(function(aa){for(X=0;X<b[aa].images.length;X++){wade.loadImage(b[aa].images[X])}});wade.loadImage(d.ship);wade.loadImage(d.flyLeft);wade.loadImage(d.flyRight);wade.loadImage(d.healthIcon);wade.loadImage(d.levelIcon);wade.loadImage(d.scoreIcon);wade.loadImage(d.missilesIcon);wade.loadImage(d.shieldsIcon);wade.loadImage(d.targetingIcon);var Z=wade.isWebAudioSupported()?"loadAudio":"preloadAudio";wade[Z](r.shoot);wade[Z](r.missile);wade[Z](r.hit);wade[Z](r.explode);wade[Z](r.loop);wade[Z](r.menu);wade[Z](r.spawn);wade[Z](r.powerup);var Y=null;Y=setInterval(function(){console.log("Loaded "+Math.round(wade.getLoadingPercentage())+"% of data.");if(wade.getLoadingPercentage()>=100){clearInterval(Y)}},1000)};this.init=function(){L=wade.retrieveLocalObject(i.data);Q=(L&&L.force2d)||Q;wade.setLayerRenderMode(T,"2d");wade.useQuadtree(T,false);s.removeClass("fa-toggle-on");s.addClass("fa-toggle-off");C.title="Enable WebGL";if(!Q){wade.setLayerRenderMode(T,"webgl");s.removeClass("fa-toggle-off");s.addClass("fa-toggle-on");C.title="Disable WebGL"}if(wade.isWebAudioSupported()){e=(L&&L.music)||e;if(wade.getWebAudioContext().state==="suspended"){e=false}if(e){l.removeClass("music-off");l.addClass("music-on");B.title="Disable music"}}else{e=false}wade.setMinScreenSize($(window).width(),$(window).height());wade.setMaxScreenSize($(window).width(),$(window).height());wade.setResolutionFactor(1);if(n){wade.setMinScreenSize($(window).width()*3,$(window).height()*3);wade.setMaxScreenSize($(window).width()*3,$(window).height()*3);wade.setResolutionFactor(0.5)}var ag=wade.getLayerRenderMode(T);var ad={insertCoin:"- INSERT COIN -",highscoreIs:"HIGHSCORE IS %i POINTS",youScored:"YOU %s %i POINTS"};if(ag==="webgl"){ad=wade.app.padStrings(ad)}var ae=new TextSprite(ad.insertCoin,"36pt Highspeed","white","center");ae.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,ae.draw));var ab=new SceneObject();ab.addSprite(ae,{y:320});wade.app.getHighestScore(c,ab,ad);if(c>0){var af=Base64.decode("U0NPUkVE");if(z){af=Base64.decode("Q0hFQVRFRA==")}else{$("#highscoreWrapper").fadeToggle();wade.app.loadHighscore(c)}var Y=ad.youScored.replace("%s",af);Y=Y.replace("%i",c);if(ag==="webgl"){Y=wade.app.padStrings(Y)}ab.addSprite(new TextSprite(Y,"24pt Highspeed","white","center"),{y:120});if(c>o){var aa=Base64.decode("TkVXIEhJR0hTQ09SRQ==");o=c;c=0;if(z){aa+=Base64.decode("IE5PVCBTQVZFRA==")}aa+="!";if(ag==="webgl"){aa=wade.app.padStrings(aa)}var ac=new TextSprite(aa,"24pt Highspeed","yellow","center");ab.addSprite(ac,{y:160})}}ab.addSprite(new Sprite(d.logo),{y:-200});W=new SceneObject();var Z=new TextSprite("PAUSED","32pt Highspeed","yellow","center");Z.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,Z.draw));W.addSprite(new Sprite(d.logo),{y:-200});W.addSprite(Z,{y:160});K.style.display="block";H.style.cursor="default";wade.addSceneObject(ab);var X=null;X=setInterval(function(){if(wade.getLoadingPercentage()>=100){console.log("Initializing asteroids on main screen.");S=wade.setTimeout(wade.app.spawnAsteroid,g);clearInterval(X)}},1000);if(e){wade.app.musicOn()}wade.app.onMouseDown=function(){if(wade.isMouseDown(0)||(wade.isMouseDown()&&(n||u))){K.style.display="none";H.style.cursor="none";y=1000;g=1000;N=1000;M={missiles:{fired:0,hit:0},bullets:{fired:-1,hit:0}};wade.clearTimeout(S);wade.removeSceneObject(ab);wade.clearScene();wade.removeUnusedLayers([1]);wade.clearCanvas(T);wade.app.onMouseDown=0;wade.app.startGame()}}};this.getHighestScore=function(aa,Z,Y){var X=setInterval(function(){var ad={action:"getHighestScore"};var ab=JSON.stringify(ad);var ac=Base64.encode(ab);$.ajax({url:"php/backend.php",type:"POST",data:"data="+ac,complete:function(ae){if(ae===null||ae===""||ae==="FAILED"){ae=o}if(aa<=0||ae>aa){Y.highscoreIs=Y.highscoreIs.replace("%i",ae);Z.addSprite(new TextSprite(Y.highscoreIs,"24pt Highspeed","yellow","center"),{y:160})}o=ae;clearInterval(X)},error:function(ag,ae,af){console.warn("getHighestScore(): AJAX call returned: "+ae+": "+af)}})},1000)};this.loadHighscore=function(Z){var aa={action:"loadScore"};var X=JSON.stringify(aa);var Y=Base64.encode(X);var ab="Highscore not loaded!";Z=(typeof(Z)!=="undefined")?Z:c;$.ajax({url:"php/backend.php",type:"POST",data:"data="+Y,complete:function(ad){if(ad!=="FAILED"){var ag="";var ac='<tr><td id="playerNameCell"><input type="text" class="highscore" id="playerName" maxlength="20" value="" placeholder="Enter your name"/></td><td>'+Z+"</td></tr>";var ae=JSON.parse(ad);var af=Object.keys(ae).length;var ah=false;$.each(ae,function(ai,aj){if(Z>0&&Z>=aj.score&&!ah){ag+=ac;ah=true}if(ai<9||!ah){ag+="<tr><td>"+aj.player+"</td><td>"+aj.score+"</td></tr>"}});if(af<10&&!ah&&Z>0){ag+=ac;ah=true}$("#highscoreTable").html(ag);if(ah){$("#playerName").focus();$("#playerName").on("keypress",function(aj){if(aj.keyCode===13){aj.preventDefault();var ai=$("#playerName").val();if(ai.length>0){$(this).prop("disabled",true);wade.app.saveHighscore(Z,ai);c=0;$("#playerName").remove();$("#playerNameCell").text(ai)}return false}})}}else{console.warn("AJAX call by loadHighscore() returned: "+ad)}},error:function(ae,ac,ad){console.warn("AJAX call by loadHighscore() returned: "+ac+": "+ad);$(".msg").html(ab)}})};this.saveHighscore=function(aa,Y){aa=(typeof(aa)!=="undefined")?aa:c;Y=(typeof(Y)!=="undefined")?Y:"Player";var ac="Highscore not saved!";var ab={action:"saveScore",player:Y,score:aa};var X=JSON.stringify(ab);var Z=Base64.encode(X);$.ajax({url:"php/backend.php",type:"POST",data:"data="+Z,complete:function(ad){if(ad==="OK"){ac="Highscore saved!"}else{L={force2d:Q,music:e,highscore:aa};wade.storeLocalObject(i.data,L)}$(".msg").html(ac)},error:function(af,ad,ae){console.warn("saveHighscore() returned: "+ad+": "+ae);$(".msg").html(ac)}})};this.handleMouseMove=function(ac,X,aa){var Z=ac.getPosition();var Y=ac.getSprite();var ab=null;if(Z.x<0){if(Z.x>aa.screenPosition.x){ab=new Animation(X.flyLeft,5,1,30)}else{if(Z.x<aa.screenPosition.x){ab=new Animation(X.flyRight,5,1,30)}}}else{if(Z.x>0){if(Z.x<aa.screenPosition.x){ab=new Animation(X.flyRight,5,1,30)}else{if(Z.x>aa.screenPosition.x){ab=new Animation(X.flyLeft,5,1,30)}}}}if(ab!==null){Y.addAnimation("fly",ab);ac.playAnimation("fly");ac.onAnimationEnd=function(){Y.setImageFile(X.ship)}}return ac&&ac.setPosition(aa.screenPosition.x,aa.screenPosition.y)};this.startGame=function(){console.log("Re-enabling quadtree optimizations.");wade.useQuadtree(T,true);var am=new Sprite(d.ship);var ap=wade.getMousePosition();J=new SceneObject(am,0,ap.x,ap.y);wade.addSceneObject(J);var al=false;wade.setMainLoop(function(){t=R;if(wade.isMouseDown(2)&&z){t=50}var aF=v+1/t;var ax=wade.getAppTime();if((wade.isMouseDown(0)||wade.isMouseDown(2)||(wade.isMouseDown()&&(n||u)))&&ax>=aF){v=ax;var aA=J.getPosition();var aD=J.getSprite().getSize();var aG;var az;if(D>0){M.missiles.fired++;D--;az=r.missile;aG=new Sprite(d.shipMissile);al=true}else{M.bullets.fired++;az=r.shoot;aG=new Sprite(d.shipBullet);al=false}var au=new SceneObject(aG,0,aA.x,aA.y-aD.y/2);wade.addSceneObject(au);wade.playAudio(az,false);A.push(au);au.moveTo(aA.x,-500,600);au.onMoveComplete=function(){wade.removeSceneObject(this);wade.removeObjectFromArray(this,A)};if(c>0&&!z&&t<60){c-=10}if(c<0||c==="NaN"){c=0}}if(A.length>0){for(var aB=A.length-1;aB>=0;aB--){var aE=A[aB].getOverlappingObjects();if(aE.length>0){for(var ay=0;ay<aE.length;ay++){if(aE[ay].isEnemy){if(D>0){M.missiles.hit++}else{M.bullets.hit++}var aC=aE[ay].getPosition();wade.app.explosion(aC,1);wade.playAudio(r.hit,false);if(aE[ay].health>0){if(al){aE[ay].health-=P}else{aE[ay].health-=w}}if(aE[ay].health<=0){wade.app.explosion(aC,2);wade.playAudio(r.explode,false);var av=aE[ay].isAsteroid;wade.removeSceneObject(aE[ay]);c+=Math.floor(aE[ay].initialHealth/10)*h;var at=wade.app.getRandomInt(0,9);var aw=[4,9];if(av&&aw.indexOf(at)>-1){wade.app.spawnPowerUp(aC)}}wade.removeSceneObject(A[aB]);wade.removeObjectFromArrayByIndex(aB,A);break}}}}}if(Math.floor(c/y)>0){if(c>=y){h+=1;y=Math.pow(10,h+2)}if(!z){j+=100}if(N>200){N-=100}if(g>400){g-=100}if(h>=5){g=200}if(R<50){R+=1}if(w<600){w+=(h*10)}}E.getSprite().setText(j);m.getSprite().setText(h);f.getSprite().setText(D);if(h>=5){I.getSprite().setText(Math.floor(c)+" / OVERKILL!")}else{I.getSprite().setText(Math.floor(c)+" / "+(y-Math.floor(c)))}x.getSprite().setText(q);V.getSprite().setText(O)},"fire");wade.setMainLoop(function(){var au=J.getOverlappingObjects(false,"axis-aligned");var at=false;var av=1;if(au.length>0){for(var aw=0;aw<au.length;aw++){if(typeof(au[aw])!=="undefined"){if(au[aw].isEnemy||au[aw].isEnemyBullet||au[aw].isPowerUp){if(J.overlapsObject(au[aw],"pixel")){if(au[aw].isPowerUp){wade.playAudio(r.powerup,false);switch(au[aw].name){case"cannister":c+=au[aw].initialValue;break;case"heart":j+=au[aw].initialValue;break;case"missiles":if(D<250){D+=au[aw].initialValue}break;case"shield":if(q<100){q+=au[aw].initialValue}break;case"targeting":if(O<10){O+=au[aw].initialValue}break}wade.removeSceneObject(au[aw]);wade.removeObjectFromArrayByIndex(aw,au);at=false;break}if(au[aw].health>0){au[aw].health-=Math.floor(w/10)}av=au[aw].damage||av;if(au[aw].isEnemyBullet||au[aw].health<=0){wade.removeSceneObject(au[aw]);wade.removeObjectFromArrayByIndex(aw,au)}at=true;break}}}at=false}}if(at){at=false;wade.app.explosion(J.getPosition(),0);wade.playAudio(r.hit,false);if(j>0){if(q>0){q-=av}else{j-=av}}if(q<0||q==="NaN"){q=0}if(j<0||j==="NaN"){j=0}if(D<0||D==="NaN"){D=0}if(O<0||O==="NaN"){O=0}E.getSprite().setText(j);f.getSprite().setText(D);x.getSprite().setText(q);V.getSprite().setText(O)}if(j<=0){var aA=wade.app.explosion(J.getPosition(),2);wade.playAudio(r.explode,false);wade.removeSceneObject(J);wade.setMainLoop(null,"fire");wade.setMainLoop(null,"die");var ay=(M.bullets.fired==0)?0:Math.round((M.bullets.hit/M.bullets.fired)*100);var aB=(M.missiles.fired==0)?0:Math.round((M.missiles.hit/M.missiles.fired)*100);var ax=(ay+aB)*100;ax=Math.max(Math.round(ax/1000)*1000,1000);c+=ax;if(!z&&c>o){L={force2d:Q,music:e,highscore:c};wade.storeLocalObject(i.data,L)}var az=setInterval(function(){if(!aA.isPlaying()){p=false;if(e){wade.app.musicOn()}wade.clearTimeout(F);wade.clearTimeout(S);clearInterval(az);wade.clearScene();wade.app.init()}},100)}},"die");if(!p){if(z){j=999}else{j=100}c=0;h=1;R=4;w=200;p=true;if(e){wade.app.musicOn()}}var ah=new Sprite(d.levelIcon);var ae=new SceneObject(ah,0,20-(wade.getScreenWidth()/2),-12-wade.getScreenHeight()/2+30);wade.addSceneObject(ae);var ao=new TextSprite(h,"32pt Highspeed","#f88","left");m=new SceneObject(ao,0,40-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(m);var aa=new Sprite(d.targetingIcon);var ak=new SceneObject(aa,0,110-(wade.getScreenWidth()/2),-10-wade.getScreenHeight()/2+30);wade.addSceneObject(ak);var an=new TextSprite(O.toString(),"32pt Highspeed","#f88","center");V=new SceneObject(an,0,170-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(V);var Z=new Sprite(d.missilesIcon);var Y=new SceneObject(Z,0,250-(wade.getScreenWidth()/2),-10-wade.getScreenHeight()/2+30);wade.addSceneObject(Y);var aj=new TextSprite(D.toString(),"32pt Highspeed","#f88","center");f=new SceneObject(aj,0,310-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(f);var af=new Sprite(d.shieldsIcon);var aq=new SceneObject(af,0,390-(wade.getScreenWidth()/2),-10-wade.getScreenHeight()/2+30);wade.addSceneObject(aq);var ad=new TextSprite(q.toString(),"32pt Highspeed","#f88","center");x=new SceneObject(ad,0,450-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(x);var ac=new Sprite(d.healthIcon);var ai=new SceneObject(ac,0,-120,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(ai);var ab=new TextSprite(j.toString(),"32pt Highspeed","#f88","center");E=new SceneObject(ab,0,-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(E);var ar=new Sprite(d.scoreIcon);var X=new SceneObject(ar,0,wade.getScreenWidth()/2-20,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(X);var ag=new TextSprite(c.toString(),"32pt Highspeed","#f88","right");I=new SceneObject(ag,0,wade.getScreenWidth()/2-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(I);F=wade.setTimeout(wade.app.spawnEnemy,N);S=wade.setTimeout(wade.app.spawnAsteroid,g)};this.pauseGame=function(){wade.clearTimeout(S);wade.app.musicOff();if(p&&!U){U=true;wade.clearTimeout(F);wade.app.onMouseMove=null;wade.addSceneObject(W);H.style.cursor="default"}wade.pauseSimulation()};this.onKeyDown=function(X){if(p&&X.keyCode===32){if(!U){console.log("Game paused by user.");wade.app.pauseGame();U=true}else{U=false;console.log("Game resumed by user.");H.style.cursor="none";F=wade.setTimeout(wade.app.spawnEnemy,N);S=wade.setTimeout(wade.app.spawnAsteroid,g);wade.removeSceneObject(W);if(e){wade.app.musicOn()}wade.resumeSimulation();wade.app.onMouseMove=function(Y){if(typeof(J)!=="undefined"){wade.app.handleMouseMove(J,d,Y)}}}}return false};this.onMouseMove=function(X){if(typeof(J)!=="undefined"){return wade.app.handleMouseMove(J,d,X)}};this.explosion=function(Y,Z){if(typeof(Z)==="undefined"||Z===null||typeof(d.boom[Z])==="undefined"){Z=0}var aa=new Animation(d.boom[Z].file,d.boom[Z].x,d.boom[Z].y,d.boom[Z].speed);var X=new Sprite();X.setSize(100,100);X.addAnimation("boom",aa);var ab=new SceneObject(X,0,Y.x,Y.y);wade.addSceneObject(ab);ab.playAnimation("boom");ab.onAnimationEnd=function(){wade.removeSceneObject(this)};return aa};this.getRandomCoords=function(X){return{x1:(Math.random()-0.5)*wade.getScreenWidth(),y1:-wade.getScreenHeight()/2-X.getSize().y/2,x2:(Math.random()-0.5)*wade.getScreenWidth(),y2:Math.abs(wade.getScreenHeight()/2-X.getSize().y/2)}};this.getRandomInt=function(Y,X){return Math.floor(Math.random()*(X-Y+1))+Y};this.spawnPowerUp=function(aa){var Z;var X=wade.app.getRandomInt(0,2);var ab=wade.app.getRandomInt(0,4);var Y;switch(ab){case 1:Y=b.heart;break;case 2:Y=b.missiles;break;case 3:Y=b.shield;break;case 4:Y=b.targeting;break;default:Y=b.cannister;break}if(Y!==b.targeting||O<=0){Z=new Sprite(Y.images[X]);var ac=wade.app.getRandomCoords(Z);var ad=new SceneObject(Z,0,aa.x,aa.y);wade.addSceneObject(ad);ad.moveTo(ac.x2,ac.y2,200);ad.isEnemy=false;ad.isAsteroid=false;ad.isPowerUp=true;ad.initialValue=Y.values[X];ad.name=Y.name;ad.damage=0;wade.playAudio(r.spawn,false);ad.onMoveComplete=function(){wade.removeSceneObject(this)}}};this.spawnAsteroid=function(){console.log("spawnAsteroid, Game paused = "+U);if(U){return false}var Y;var Z=wade.app.getRandomInt(0,9);Y=new Sprite(d.asteroids[Z]);var aa=wade.app.getRandomCoords(Y);var X=new SceneObject(Y,0,aa.x1,aa.y1);wade.addSceneObject(X);X.moveTo(aa.x2,aa.y2,200);X.isEnemy=true;X.isAsteroid=true;X.isPowerUp=false;X.health=k[Z];X.initialHealth=k[Z];X.damage=Math.floor(k[Z]/100);X.onMoveComplete=function(){wade.removeSceneObject(this)};S=wade.setTimeout(wade.app.spawnAsteroid,g)};this.spawnEnemy=function(){if(U){return false}var Z;var Y=h-1;var aa=Object.keys(d.enemies).length-1;if(Y>aa){Y=aa}var ac=wade.app.getRandomInt(0,Y);if(h>=5){ac=4}Z=new Sprite(d.enemies[ac]);var ab=wade.app.getRandomCoords(Z);var X=new SceneObject(Z,0,ab.x1,ab.y1);wade.addSceneObject(X);X.moveTo(ab.x2,ab.y2,200);X.isEnemy=true;X.isAsteroid=false;X.isPowerUp=false;X.health=G[ac];X.initialHealth=G[ac];X.damage=Math.floor(G[ac]/100);X.onMoveComplete=function(){wade.removeSceneObject(this)};X.originalStep=X.step;X.step=function(){this.originalStep();var ad=this.getPosition();var ae=J.getPosition();var af=Math.atan2(ae.y-ad.y,ae.x-ad.x)-3.14/2;this.setRotation(af)};X.fire=function(){var an=this.getSprite().getSize();var aj=this.getPosition();var ah=J.getPosition();var ao=ah.x-aj.x;var am=ah.y-aj.y;var ae=Math.sqrt(ao*ao+am*am);ao/=ae;am/=ae;var ag=aj.x+ao*an.x/2;var af=aj.y+am*an.y/2;var al=ag+ao*3000;var ak=af+am*3000;var ai=new Sprite(d.enemyBullets[ac].file);var ad=new SceneObject(ai,0,ag,af);ad.isEnemyBullet=true;ad.damage=d.enemyBullets[ac].damage;wade.addSceneObject(ad);ad.moveTo(al,ak,200);ad.onMoveComplete=function(){wade.removeSceneObject(this)};this.schedule(d.enemyBullets[ac].delay,"fire")};if(O>0){wade.setTimeout(function(){O--;if(O<0||O==="NaN"){O=0}V.getSprite().setText(O)},1000)}else{X.schedule(300,"fire")}F=wade.setTimeout(wade.app.spawnEnemy,N)};this.toggleRenderer=function(){Q=!Q;L={force2d:Q,music:e,highscore:o};wade.storeLocalObject(i.data,L);wade.clearTimeout(F);wade.clearTimeout(S);wade.setMainLoop(null,"fire");wade.setMainLoop(null,"die");p=false;wade.clearScene();wade.app.init()};this.musicOn=function(){if(a>-1){wade.stopAudio(a)}else{wade.stopAudio()}if(p){a=wade.playAudio(r.loop,true)}else{a=wade.playAudio(r.menu,true)}if(a<0){l.removeClass("music-on");l.addClass("music-off");B.title="Enable music";e=false}return false};this.musicOff=function(){if(a>-1){wade.stopAudio(a)}else{wade.stopAudio()}return false};this.toggleMusic=function(){var X=wade.getWebAudioContext();if(X.state==="suspended"){X.resume().then(function(){console.log("Audio context resumed.")})}if(e){e=false;l.removeClass("music-on");l.addClass("music-off");B.title="Enable music";wade.app.musicOff()}else{e=true;l.removeClass("music-off");l.addClass("music-on");B.title="Disable music";wade.app.musicOn()}L={force2d:Q,music:e,highscore:o};wade.storeLocalObject(i.data,L);return false}};