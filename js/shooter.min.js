var version='1.0.9';$('#version').text(version);var cheat=false;function getRandomInt(a,b){'use strict';return Math.floor(Math.random()*(b-a+1))+a}function padStrings(a){'use strict';var b='       ';var d;if(typeof(a)==='object'){d={};for(var c in a){if({}.hasOwnProperty.call(a,c)){d[c]=b+a[c]+b}}}else{d=b+a+b}return d}function handleMouseMove(a,b,d){'use strict';var c=a.getPosition();var g=a.getSprite();var f=null;if(c.x<0){if(c.x>d.screenPosition.x){f=new Animation(b.flyLeft,5,1,30)}else if(c.x<d.screenPosition.x){f=new Animation(b.flyRight,5,1,30)}}else if(c.x>0){if(c.x<d.screenPosition.x){f=new Animation(b.flyRight,5,1,30)}else if(c.x>d.screenPosition.x){f=new Animation(b.flyLeft,5,1,30)}}if(f!==null){g.addAnimation('fly',f);a.playAnimation('fly');a.onAnimationEnd=function(){g.setImageFile(b.ship)}}return a&&a.setPosition(d.screenPosition.x,d.screenPosition.y)}var App=function(){'use strict';var M=false||checkForMobileDevice();var U=false||getBrowserVersion('Trident/([0-9]{1,}[.0-9]{0,})');var j;var G=false;var w=false;var H=null;var q=false;var V=1;var bb=0;var I=4;var N=4;var D=200;var W=[400,600,800,1500,5000];var J=2000;var E;var X=[200,200,200,300,400,400,600,500,400,600];var A=1000;var s;var B=[];var Y;var h=0;var C={data:'overkill',};var O;var p=100;var Z;var t=1;var x=null;var m=false;var i=wade.retrieveLocalObject(C.data);var u=(i&&i.highscore)||0;var e={logo:'../img/logo.png',ship:'../img/ship.png',boom:{0:{file:'../img/animations/explosion/explode_4x4_ship.png',speed:30,x:4,y:4},1:{file:'../img/animations/explosion/explode_4x4_ring.png',speed:30,x:4,y:4},2:{file:'../img/animations/explosion/explode_5x3_enemy.png',speed:30,x:5,y:3}},flyLeft:'../img/animations/ship/fly_left.png',flyRight:'../img/animations/ship/fly_right.png',shipBullet:'../img/bullets/bullet_ship.png',enemyBullets:{0:{file:'../img/bullets/bullet0.png',delay:600,damage:1},1:{file:'../img/bullets/bullet1.png',delay:500,damage:3},2:{file:'../img/bullets/bullet2.png',delay:400,damage:5},3:{file:'../img/bullets/bullet3.png',delay:300,damage:10},4:{file:'../img/bullets/bullet4.png',delay:200,damage:20}},enemies:{0:'../img/enemies/enemy0.png',1:'../img/enemies/enemy1.png',2:'../img/enemies/enemy2.png',3:'../img/enemies/enemy3.png',4:'../img/enemies/enemy4.png'},asteroids:{0:'../img/asteroids/asteroid0.png',1:'../img/asteroids/asteroid1.png',2:'../img/asteroids/asteroid2.png',3:'../img/asteroids/asteroid3.png',4:'../img/asteroids/asteroid4.png',5:'../img/asteroids/asteroid5.png',6:'../img/asteroids/asteroid6.png',7:'../img/asteroids/asteroid7.png',8:'../img/asteroids/asteroid8.png',9:'../img/asteroids/asteroid9.png'},healthIcon:'../img/icons/heart.png',levelIcon:'../img/icons/star.png',scoreIcon:'../img/icons/trophy.png'};var r={shoot:'../sounds/shoot.mp3',hit:'../sounds/hit.mp3',explode:'../sounds/explode.mp3',loop:'../sounds/loop.mp3'};var bc=document.getElementById('toggleRendererTitle');var P=$('#toggleRendererBtn');var Q=document.getElementById('toggleMusicTitle');var y=$('#toggleMusicBtn');var R=document.getElementById('game');var bd=document.getElementById('game-icons');wade.preventIframe();wade.setLoadingBar(true,{x:0,y:0},'#333333','#222222');wade.setLoadingImages('../img/loading.svg');this.load=function(){var a=0;wade.loadImage(e.logo);wade.loadImage(e.ship);wade.loadImage(e.shipBullet);for(a=0;a<Object.keys(e.enemyBullets).length;a++){wade.loadImage(e.enemyBullets[a].file)}for(a=0;a<Object.keys(e.boom).length;a++){wade.loadImage(e.boom[a].file)}wade.loadImage(e.flyLeft);wade.loadImage(e.flyRight);wade.loadImage(e.healthIcon);wade.loadImage(e.levelIcon);wade.loadImage(e.scoreIcon);for(a=0;a<Object.keys(e.enemies).length;a++){wade.loadImage(e.enemies[a])}for(a=0;a<Object.keys(e.asteroids).length;a++){wade.loadImage(e.asteroids[a])}var b=wade.isWebAudioSupported()?'loadAudio':'preloadAudio';wade[b](r.shoot);wade[b](r.hit);wade[b](r.explode);wade[b](r.loop)};this.init=function(){i=wade.retrieveLocalObject(C.data);q=(i&&i.force2d)||q;if(q){wade.setLayerRenderMode(V,'2d');P.removeClass('fa-toggle-on');P.addClass('fa-toggle-off');bc.title='Enable WebGL'}else{wade.setLayerRenderMode(V,'webgl');P.removeClass('fa-toggle-off');P.addClass('fa-toggle-on');bc.title='Disable WebGL'}if(wade.isWebAudioSupported()){m=(i&&i.music)||m;if(m){y.removeClass('music-off');y.addClass('music-on');Q.title='Disable music'}}else{m=false}wade.setMinScreenSize($(window).width(),$(window).height());wade.setMaxScreenSize($(window).width(),$(window).height());wade.setResolutionFactor(1);if(M){wade.setMinScreenSize($(window).width()*3,$(window).height()*3);wade.setMaxScreenSize($(window).width()*3,$(window).height()*3);wade.setResolutionFactor(0.5)}var a=wade.getLayerRenderMode(V);if(debug){log('\n\t\tbrowser screen size   : '+$(window).width()+'x'+$(window).height()+'\n\t\tactual min screen size: '+wade.getMinScreenWidth()+'x'+wade.getMinScreenHeight()+'\n\t\tactual max screen size: '+wade.getMaxScreenWidth()+'x'+wade.getMaxScreenHeight()+'\n\t\trender-mode           : '+a+'\n\t\tforce2D               : '+q+'\n\t\tisMobile              : '+M+'\n\t\tisCheater             : '+cheat+'\n\t\tcurrent score         : '+h+'\n\t\thighscore             : '+u+'\n\t\tlevel                 : '+t+'\n\t\tplayer health         : '+p+'\n\t\tfire rate             : '+I+'\n\t\tfire damage           : '+D)}var b={insertCoin:'- INSERT COIN -',highscoreIs:'HIGHSCORE IS %i POINTS',youScored:'YOU %s %i POINTS'};if(a==='webgl'){b=padStrings(b)}var d=new TextSprite(b.insertCoin,'36pt Highspeed','white','center');d.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,d.draw));var c=new SceneObject();c.addSprite(d,{y:320});if(h<=0||u>=h){b.highscoreIs=b.highscoreIs.replace('%i',u);c.addSprite(new TextSprite(b.highscoreIs,'24pt Highspeed','yellow','center'),{y:160})}if(h>0){var g='SCORED';if(cheat){g='CHEATED'}var f=b.youScored.replace('%s',g);f=f.replace('%i',h);if(a==='webgl'){f=padStrings(f)}c.addSprite(new TextSprite(f,'24pt Highspeed','white','center'),{y:120});if(h>u){var n='NEW HIGHSCORE';u=h;if(cheat){n+=' NOT SAVED'}n+='!';if(a==='webgl'){n=padStrings(n)}var o=new TextSprite(n,'24pt Highspeed','yellow','center');c.addSprite(o,{y:160})}}if(!cheat){i={q,music:m,highscore:u};wade.storeLocalObject(C.data,i)}c.addSprite(new Sprite(e.logo),{y:-200});H=new SceneObject();var k=new TextSprite('PAUSED','32pt Highspeed','yellow','center');k.setDrawFunction(wade.drawFunctions.blink_(0.5,0.5,k.draw));H.addSprite(new Sprite(e.logo),{y:-200});H.addSprite(k,{y:160});bd.style.display='block';R.style.cursor='default';wade.addSceneObject(c);s=setTimeout(wade.app.spawnAsteroid,A);if(wade.isWebAudioSupported()){if(m&&x===null){x=wade.playAudio(r.loop,true);if(x<0){y.removeClass('music-on');y.addClass('music-off');Q.title='Enable music';m=false}}}wade.app.onMouseDown=function(){if(wade.isMouseDown(0)||(wade.isMouseDown()&&(M||U))){bd.style.display='none';R.style.cursor='none';clearTimeout(s);wade.removeSceneObject(c);wade.clearScene();wade.removeUnusedLayers([1]);wade.app.startGame();wade.app.onMouseDown=0}}};this.startGame=function(){var ba=new Sprite(e.ship);var z=wade.getMousePosition();j=new SceneObject(ba,0,z.x,z.y);wade.addSceneObject(j);wade.setMainLoop(function(){N=I;if(wade.isMouseDown(2)&&cheat){N=50}var a=bb+1/N;var b=wade.getAppTime();if((wade.isMouseDown(0)||wade.isMouseDown(2)||(wade.isMouseDown()&&(M||U)))&&b>=a){bb=b;var d=j.getPosition();var c=j.getSprite().getSize();var g=new Sprite(e.shipBullet);var f=new SceneObject(g,0,d.x,d.y-c.y/2);wade.addSceneObject(f);wade.playAudio(r.shoot,false);B.push(f);f.moveTo(d.x,-500,600);f.onMoveComplete=function(){wade.removeSceneObject(this);wade.removeObjectFromArray(this,B)};if(h>0&&!cheat&&N<60){h-=10}if(h<0||h==='NaN'){h=0}}if(B.length>0){for(var n=B.length-1;n>=0;n--){var o=B[n].getOverlappingObjects();if(o.length>0){for(var k=0;k<o.length;k++){if(o[k].isEnemy){var S=o[k].getPosition();wade.app.explosion(S,1);wade.playAudio(r.hit,false);if(o[k].health>0){o[k].health-=D}if(o[k].health<=0){wade.app.explosion(S,2);wade.playAudio(r.explode,false);wade.removeSceneObject(o[k]);h+=Math.floor(o[k].initialHealth/10)*t}wade.removeSceneObject(B[n]);wade.removeObjectFromArrayByIndex(n,B);break}}}}}if(Math.floor(h/1000)>t-1&&t<5){t+=1;if(!cheat){p=100}if(J>200){J-=100}if(A>400){A-=100}if(I<50){I+=1}if(D<600){D+=(t*10)}}O.getSprite().setText(p);Z.getSprite().setText(t);Y.getSprite().setText(Math.floor(h))},'fire');wade.setMainLoop(function(){var a=j.getOverlappingObjects(false,'axis-aligned');var b=false;var d=1;if(a.length>0){for(var c=0;c<a.length;c++){if(typeof(a[c])!=='undefined'){if(a[c].isEnemy||a[c].isEnemyBullet){if(typeof(a[c])!=='undefined'&&j.overlapsObject(a[c],'pixel')){if(a[c].health>0){a[c].health-=Math.floor(D/10)}if(typeof(a[c])!=='undefined'&&(a[c].isEnemyBullet||a[c].health<=0)){wade.removeSceneObject(a[c]);wade.removeObjectFromArrayByIndex(c,a)}if(typeof(a[c])!=='undefined'){d=a[c].damage||d}b=true;break}}}}}if(b){b=false;wade.app.explosion(j.getPosition(),0);wade.playAudio(r.hit,false);if(p>0){p-=d}if(p<0||p==='NaN'){p=0}O.getSprite().setText(p)}if(p<=0){var g=wade.app.explosion(j.getPosition(),2);wade.playAudio(r.explode,false);wade.removeSceneObject(j);wade.setMainLoop(null,'fire');wade.setMainLoop(null,'die');if(!cheat&&h>u){i={q,music:m,highscore:h};wade.storeLocalObject(C.data,i)}var f=setInterval(function(){if(!g.isPlaying()){w=false;clearInterval(f);clearTimeout(E);clearTimeout(s);wade.clearScene();wade.app.init()}},100)}},'die');if(!w){if(cheat){p=999}else{p=100}h=0;t=1;I=4;D=200;w=true}var K=new Sprite(e.scoreIcon);var L=new SceneObject(K,0,wade.getScreenWidth()/2-20,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(L);var T=new TextSprite(h.toString(),'32pt Highspeed','#f88','right');Y=new SceneObject(T,0,wade.getScreenWidth()/2-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(Y);var v=new Sprite(e.healthIcon);var F=new SceneObject(v,0,-120,-10-wade.getScreenHeight()/2+30);wade.addSceneObject(F);var l=new TextSprite(p.toString(),'32pt Highspeed','#f88','center');O=new SceneObject(l,0,-40,4-wade.getScreenHeight()/2+30);wade.addSceneObject(O);var be=new Sprite(e.levelIcon);var bf=new SceneObject(be,0,20-(wade.getScreenWidth()/2),-12-wade.getScreenHeight()/2+30);wade.addSceneObject(bf);var bg=new TextSprite(t,'32pt Highspeed','#f88','left');Z=new SceneObject(bg,0,40-(wade.getScreenWidth()/2),4-wade.getScreenHeight()/2+30);wade.addSceneObject(Z);E=setTimeout(wade.app.spawnEnemy,J);s=setTimeout(wade.app.spawnAsteroid,A)};this.pauseGame=function(){wade.pauseSimulation();clearTimeout(E);clearTimeout(s);wade.app.onMouseMove=null;wade.addSceneObject(H);R.style.cursor='default';return false};$(window).blur(function(){if(w&&!G){console.log('Game paused due to focus loss.');G=true;wade.app.pauseGame()}else{if(!w){console.log('Asteroid timeout cleared due to focus loss.');clearTimeout(s)}}return false});$(window).focus(function(){if(!w){s=setTimeout(wade.app.spawnAsteroid,A)}});this.onKeyDown=function(b){if(w&&b.keyCode===32){G=!G;if(G){wade.app.pauseGame()}else{R.style.cursor='none';E=setTimeout(wade.app.spawnEnemy,J);s=setTimeout(wade.app.spawnAsteroid,A);wade.removeSceneObject(H);wade.resumeSimulation();wade.app.onMouseMove=function(a){if(typeof(j)!=='undefined'){handleMouseMove(j,e,a)}}}}return false};this.onMouseMove=function(a){if(typeof(j)!=='undefined'){return handleMouseMove(j,e,a)}};this.explosion=function(a,b){if(typeof(b)==='undefined'||b===null||typeof(e.boom[b])==='undefined'){b=0}var d=new Animation(e.boom[b].file,e.boom[b].x,e.boom[b].y,e.boom[b].speed);var c=new Sprite();c.setSize(100,100);c.addAnimation('boom',d);var g=new SceneObject(c,0,a.x,a.y);wade.addSceneObject(g);g.playAnimation('boom');g.onAnimationEnd=function(){wade.removeSceneObject(this)};return d};this.getRandomCoords=function(a){return{x1:(Math.random()-0.5)*wade.getScreenWidth(),y1:-wade.getScreenHeight()/2-a.getSize().y/2,x2:(Math.random()-0.5)*wade.getScreenWidth(),y2:Math.abs(wade.getScreenHeight()/2-a.getSize().y/2)}};this.spawnAsteroid=function(){var a;var b=getRandomInt(0,9);a=new Sprite(e.asteroids[b]);var d=wade.app.getRandomCoords(a);var c=new SceneObject(a,0,d.x1,d.y1);wade.addSceneObject(c);c.moveTo(d.x2,d.y2,200);c.isEnemy=true;c.isAsteroid=true;c.health=X[b];c.initialHealth=X[b];c.damage=Math.floor(X[b]/100);c.onMoveComplete=function(){wade.removeSceneObject(this)};s=setTimeout(wade.app.spawnAsteroid,A)};this.spawnEnemy=function(){var K;var L=t-1;var T=Object.keys(e.enemies).length-1;if(L>T){L=T}var v=getRandomInt(0,L);K=new Sprite(e.enemies[v]);var F=wade.app.getRandomCoords(K);var l=new SceneObject(K,0,F.x1,F.y1);wade.addSceneObject(l);l.moveTo(F.x2,F.y2,200);l.isEnemy=true;l.isAsteroid=false;l.health=W[v];l.initialHealth=W[v];l.damage=Math.floor(W[v]/100);l.onMoveComplete=function(){wade.removeSceneObject(this)};l.originalStep=l.step;l.step=function(){this.originalStep();var a=this.getPosition();var b=j.getPosition();var d=Math.atan2(b.y-a.y,b.x-a.x)-3.14/2;this.setRotation(d)};l.fire=function(){var a=this.getSprite().getSize();var b=this.getPosition();var d=j.getPosition();var c=d.x-b.x;var g=d.y-b.y;var f=Math.sqrt(c*c+g*g);c/=f;g/=f;var n=b.x+c*a.x/2;var o=b.y+g*a.y/2;var k=n+c*3000;var S=o+g*3000;var ba=new Sprite(e.enemyBullets[v].file);var z=new SceneObject(ba,0,n,o);z.isEnemyBullet=true;z.damage=e.enemyBullets[v].damage;wade.addSceneObject(z);z.moveTo(k,S,200);z.onMoveComplete=function(){wade.removeSceneObject(this)};this.schedule(e.enemyBullets[v].delay,'fire')};l.schedule(300,'fire');E=setTimeout(wade.app.spawnEnemy,J)};this.toggleRenderer=function(){q=!q;i={q,music:m,highscore:u};wade.storeLocalObject(C.data,i);clearTimeout(E);clearTimeout(s);wade.setMainLoop(null,'fire');wade.setMainLoop(null,'die');w=false;wade.clearScene();wade.app.init()};this.toggleMusic=function(){if(m){m=false;y.removeClass('music-on');y.addClass('music-off');Q.title='Enable music';if(U){i={q,music:m,highscore:u};wade.storeLocalObject(C.data,i);location.reload()}else{if(x>-1){wade.stopAudio(x)}else{wade.stopAudio()}}}else{if(x>-1){wade.stopAudio(x)}else{wade.stopAudio()}x=wade.playAudio(r.loop,true);m=true;y.removeClass('music-off');y.addClass('music-on');Q.title='Disable music'}i={q,music:m,highscore:u};wade.storeLocalObject(C.data,i);return false}};