/*! Starscroll, Jean-Christophe Nicolas, http://opensource.org/licenses/MIT */
(function(c){c.fn.starscroll=function(m,l,k,p,f,d,o,j,n,h){var i=c(this),e=a.any();var h=h||false;if(h){e=false}var g=new b(i,e,m,l,k,p,f,d,o,j,n);window.addEventListener("scroll",function(){g.parallax()},false);if(j&&!e){setInterval(function(){g.time+=5;g.parallax()},1000/40)}return this.el};var b=function(l,f,m,r,o,j,g,d,q,i,n){this.el=l;this.levels=(r>10)?10:r;this.layers=[];this.dimension=(j>20)?20:j;this.density=o;this.colour=(!d)?[255,255,255]:d;this.hue=(!q)?false:q;this.bit=(!m)?false:m;this.time=0;this.anim=i;this.smooth=(g>5||true)?5:g;this.scrollspeed=(!n)?2:n;var h,k=c(window).width(),p,e=c(window).width();h=(k>700)?700:k;p=(e>600)?650:e;this.w=h;this.h=p;if(!f){this.init()}};b.prototype.init=function(){for(var d=0;d<this.levels;d++){this.layers[d]=this.buildlayers(d)}this.images=this.createStars();this.applyImages(this.images)};b.prototype.buildlayers=function(f){var h={},d=document.createElement("canvas"),e=d.getContext("2d");d.width=this.w;d.height=this.h;var g=c('<div id="starchild'+f+'"/>');this.buildDOMels(g,f);h.canvas=d;h.context=e;h.DOM=g;return h};b.prototype.createStars=function(){var d=[];for(var h=0;h<this.levels;h++){var k=this.layers[h].canvas,e=this.layers[h].context,f=this.hsl(this.colour);for(var g=0;g<this.density;g++){this.drawStar(e,h,f)}d[h]=this.convertCanvasToImage(k)}return d};b.prototype.drawStar=function(n,g,m){var j=this.dimension/(g*0.075+1),h=Math.random()*j,l=0,k=0,o=Math.random()*(h*0.9),e=(this.hue)?this.colstep(m):this.colour;l=this.boundary("x",h);k=this.boundary("y",h);var f=n.createRadialGradient(l,k,o,l,k,h),d=0.7+Math.random()*0.3;f.addColorStop(0,"rgba(255,255,255,.9)");if(e){f.addColorStop(0.5,"rgba("+e+",.8)")}f.addColorStop(1,"rgba(255,255,255,0)");n.beginPath();if(this.bit==8||false){n.fillRect(l,k,h,h);n.fillStyle="rgba(255,255,255,"+d+")"}else{n.arc(l,k,h,0,Math.PI*2,true);n.globalAlpha=0.7+Math.random()*0.3;n.fillStyle=f}n.fill()};b.prototype.colstep=function(d){d[0]=d[0]-(~~(Math.random()*4))+(~~(Math.random()*8));return this.rgb(d)};b.prototype.boundary=function(e,d){var g=d,f=0;if(e=="x"){var h=Math.random()*this.w;f=h;if(h<g){f=h+g+Math.random()*d}else{if(h>this.w-g){f=h-g-Math.random()*d}}return f}else{var h=Math.random()*this.h;f=h;if(h<g){f=h+g+Math.random()*d}else{if(h>this.h-g){f=h-g-Math.random()*d}}return f}};b.prototype.applyImages=function(g){for(var f=0;f<this.levels;f++){var e=this.layers[f].DOM,d=g[f].src;e.css({"background-image":"url("+d+")"})}};b.prototype.parallax=function(){var g=window.pageYOffset-this.time;for(var e=0;e<this.levels;e++){var d=this.layers[e].DOM,f=-g*((e+1)/this.scrollspeed);d.css({"background-position":"0 "+f+"px"})}};b.prototype.buildDOMels=function(f,e){this.el.append(f);var d="5s";if(this.anim){d="0s"}this.el.css({position:"fixed","z-index":-1,top:0,width:"100%",height:"100%"});f.css({transition:"all "+d+" cubic-bezier(0.230, 1.000, 0.320, 1.000)",position:"fixed",width:"100%",height:"100%","background-repeat":"repeat","background-color":"transparent"})};b.prototype.convertCanvasToImage=function(d){var e=new Image();e.src=d.toDataURL("image/png");return e};b.prototype.hsl=function(i){var f=i[0]/255;var d=i[1]/255;var k=i[2]/255;var e=Math.max(f,d,k);var g=Math.min(f,d,k);var j=(e+g)/2;var h=0;var l=0;if(e!=g){if(j<0.5){h=(e-g)/(e+g)}else{h=(e-g)/(2-e-g)}if(f==e){l=(d-k)/(e-g)}else{if(d==e){l=2+(k-f)/(e-g)}else{l=4+(f-d)/(e-g)}}}j=j*100;h=h*100;l=l*60;if(l<0){l+=360}var m=[l,h,j];return m};b.prototype.rgb=function(m){var f=m[0];var p=m[1];var e=m[2];var o,n,j;var d,i,k;p/=100;e/=100;if(p==0){d=i=k=(e*255)}else{if(e<=0.5){n=e*(p+1)}else{n=e+p-e*p}o=e*2-n;j=f/360;d=this.hue2rgb(o,n,j+1/3);i=this.hue2rgb(o,n,j);k=this.hue2rgb(o,n,j-1/3)}return[Math.round(d),Math.round(i),Math.round(k)]};b.prototype.hue2rgb=function(g,f,e){var d;if(e<0){e+=1}else{if(e>1){e-=1}}if(6*e<1){d=g+(f-g)*e*6}else{if(2*e<1){d=f}else{if(3*e<2){d=g+(f-g)*(2/3-e)*6}else{d=g}}}return 255*d};var a={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return(a.Android()||a.BlackBerry()||a.iOS()||a.Opera()||a.Windows())}}})(jQuery);